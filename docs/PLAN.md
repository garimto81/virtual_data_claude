# PLAN - Virtual Data Poker Hand Logger 리팩토링

## 🎯 비전

7909줄의 모놀리식 index.html을 1000줄 이하의 유지보수 가능한 모듈형 구조로 전환하여, 협업과 기능 추가가 자유로운 확장 가능한 앱으로 만든다.

## 👥 페르소나

### 민수 (개발자, 28세)

**현재 상황**:
- 문제: 7909줄짜리 index.html을 수정하려면 파일 로딩만 10초, 검색도 느림
- 소요 시간: 간단한 버그 수정에도 30분 이상 (함수 찾기 10분 + 의존성 파악 15분 + 수정 5분)
- 협업 불가: Git 병합 충돌 100% 발생, PR 리뷰 불가능
- 테스트 불가: 어디서 버그가 나는지 추적 어려움

**목표**:
- 해결: 모듈별로 분리된 파일에서 빠르게 검색하고 수정
- 목표 시간: 버그 수정 5분 이내 (검색 1분 + 수정 2분 + 테스트 2분)
- 협업 가능: 모듈별 작업으로 충돌 최소화
- 테스트 용이: 단위 테스트 추가 가능

**사용 시나리오**:
1. 핸드 전송 버그 수정 요청 (현재: 30분, 목표: 5분)
   - ❌ **현재**: index.html 열기 → Ctrl+F로 "sendData" 검색 → 5개 결과 중 찾기 → 의존성 확인 → 수정 → 전체 테스트
   - ✅ **목표**: `src/modules/hand-recorder.js` 열기 → 버그 확인 → 수정 → 모듈 테스트

2. 새 기능 추가 (현재: 불가능, 목표: 1일)
   - ❌ **현재**: 어디에 코드 넣을지 모름 → 7909줄 분석 → 포기
   - ✅ **목표**: 해당 모듈 찾기 → 함수 추가 → 테스트

3. 동료와 협업 (현재: 불가능, 목표: 병렬 작업)
   - ❌ **현재**: 같은 index.html 수정 → 충돌 → 수동 병합 2시간
   - ✅ **목표**: 각자 다른 모듈 수정 → 충돌 없이 병합

## 🖼️ 최종 앱 모습

### 파일 구조 (Before)
```
index.html (7909줄, 337KB)
├── HTML (800줄)
└── <script> (7109줄) ← 129개 함수 전부 여기
```

### 파일 구조 (After)
```
index.html (1000줄 이하)
├── HTML (800줄)
└── <script> (200줄 이하) ← 초기화 로직만

src/
├── core/
│   └── store.js (150줄) - 전역 상태 관리
├── modules/
│   ├── hand-recorder.js (500줄) - 핸드 전송
│   ├── data-loader.js (800줄) - 데이터 로딩
│   ├── pot-calculator.js (300줄) - 팟 계산
│   ├── card-selector.js (200줄) - 카드 선택
│   ├── player-manager.js (300줄) - 플레이어 관리
│   └── pure-utils.js (100줄) - 순수 함수
└── facades/
    └── *.js (각 50줄) - HTML onclick 호환
```

### 개발자 경험 (Before → After)

**코드 검색**:
- ❌ Before: Ctrl+F → 100개 결과 → 스크롤 지옥
- ✅ After: 파일명으로 직접 이동 → 10개 이내 함수

**코드 수정**:
- ❌ Before: 7909줄 스크롤 → 의존성 추적 불가
- ✅ After: 모듈 import 확인 → 명확한 의존성

**테스트**:
- ❌ Before: 전체 앱 실행 → 수동 클릭 테스트
- ✅ After: 모듈 import → 단위 테스트 작성 가능

**협업**:
- ❌ Before: 같은 파일 수정 → 충돌 100%
- ✅ After: 다른 모듈 수정 → 충돌 0%

## 💎 핵심 가치

1. **유지보수성**: 7909줄 → 1000줄, 파일 로딩 10초 → 1초
2. **가독성**: 함수 찾기 10분 → 10초 (파일명만 봐도 위치 파악)
3. **확장성**: 새 기능 추가 시 해당 모듈에만 코드 추가
4. **협업성**: 모듈별 분리로 충돌 최소화
5. **테스트 가능성**: 각 모듈 단위 테스트 가능

## ✅ 성공 기준

### 정량적 목표
- index.html: 7909줄 → **1000줄 이하** (87% 감소)
- JavaScript: 7109줄 → **200줄 이하** (97% 감소)
- 파일 크기: 337KB → **50KB 이하** (85% 감소)
- 파일 로딩 시간: 10초 → **1초 이하**

### 기능적 목표
- ✅ 모든 기능 100% 정상 작동 (핸드 전송, 데이터 로딩, 팟 계산 등)
- ✅ 기존 HTML onclick 이벤트 전부 호환 (HTML 수정 없음)
- ✅ 성능 저하 0% (오히려 모듈 lazy loading으로 개선)

### 개발자 경험 목표
- 버그 수정 시간: 30분 → **5분 이하**
- 함수 검색 시간: 10분 → **10초 이하**
- 새 기능 추가: 불가능 → **1일 이내**
- 협업 충돌률: 100% → **10% 이하**

### 검증 기준
- 모든 기능 수동 테스트 통과
- 콘솔 에러 0개
- 롤백 가능 (각 Step = 1 commit)

## 🚫 제약 조건

### 기술적 제약
- **HTML 수정 금지**: onclick 이벤트 전부 유지 (129개 함수명)
- **기능 변경 금지**: 리팩토링만, 새 기능 추가 안 함
- **의존성 최소화**: 외부 라이브러리 추가 안 함 (Dexie.js, Tailwind CSS만 유지)

### 안전성 제약
- **점진적 진행**: 한 번에 하나씩 (Step 1 → 검증 → Step 2)
- **항상 롤백 가능**: 모든 Step = 1 commit
- **검증 필수**: 매 Step마다 수동 테스트 100% 통과

### 시간 제약
- **목표**: 21일 이내 완료 (3주)
- **현재 진행률**: 1.3% (106줄 감소)
- **남은 작업**: 6803줄 감소 필요

### 과거 실패 경험 반영
- ❌ **무지성 분리 금지**: 7000줄을 한 번에 옮기면 의존성 추적 불가
- ✅ **의존성 파악 후 분리**: DEPENDENCY_MAP.md 먼저 작성
- ✅ **검증 후 다음 단계**: 매 Step마다 체크리스트 100% 완료

## 📐 설계 원칙

### Facade 패턴
```javascript
// HTML에서 호출 (변경 없음)
<button onclick="sendDataToGoogleSheet_v46()">

// Facade에서 모듈 위임
function sendDataToGoogleSheet_v46() {
  return HandRecorder.send();
}
```

### 단방향 의존성
```
index.html
  ↓ import
facades/*.js
  ↓ import
modules/*.js
  ↓ import
core/store.js
```

### 전역 노출 최소화
- 전역: window.store만 (AppStore 인스턴스)
- 모듈: export/import 사용
- Facade: 필요한 것만 window에 노출

## 🎓 참고 문서

- [DEPENDENCY_MAP.md](analysis/DEPENDENCY_MAP.md) - 8개 모듈 설계
- [STEP_BY_STEP_REFACTORING.md](STEP_BY_STEP_REFACTORING.md) - 상세 가이드
- [NEXT_SESSION_PLAN.md](NEXT_SESSION_PLAN.md) - 현재 상태 및 다음 전략
