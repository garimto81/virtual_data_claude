<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2 Test - ì¡°ê±´ë¶€ ì´ˆê¸°í™”</title>
    <style>
        body {
            font-family: -apple-system, system-ui, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #6366f1;
            padding-bottom: 10px;
        }
        h2 {
            color: #6366f1;
            margin-top: 30px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .test-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
        }
        .test-card h3 {
            margin-top: 0;
            color: #4b5563;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 10px;
        }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        button:hover {
            background: #4f46e5;
        }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }
        .result {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }
        .result.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .result.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        .result.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }
        .status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 5px;
        }
        .status.pass { background: #10b981; color: white; }
        .status.fail { background: #ef4444; color: white; }
        .status.pending { background: #f59e0b; color: white; }
        .log-area {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .scenario-step {
            background: #f3f4f6;
            border-left: 4px solid #6366f1;
            padding: 12px;
            margin: 10px 0;
            border-radius: 0 6px 6px 0;
        }
        .scenario-step.active {
            background: #fef3c7;
            border-left-color: #f59e0b;
        }
        .scenario-step.completed {
            background: #d1fae5;
            border-left-color: #10b981;
        }
        .iframe-container {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            height: 400px;
            margin: 15px 0;
        }
        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Phase 2: ì¡°ê±´ë¶€ ì´ˆê¸°í™” êµ¬í˜„ í…ŒìŠ¤íŠ¸</h1>
        <p class="text-gray-600">initializeApp() í•¨ìˆ˜ì˜ ìˆ˜ë™/ìë™ ëª¨ë“œ ë¶„ê¸°ì™€ ì„¤ì • í™”ë©´ UIë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>

        <div class="test-grid">
            <!-- ì´ˆê¸°í™” ëª¨ë“œ í…ŒìŠ¤íŠ¸ -->
            <div class="test-card">
                <h3>1. ì´ˆê¸°í™” ëª¨ë“œ í…ŒìŠ¤íŠ¸</h3>
                <button onclick="testAutoMode()">ğŸš€ ìë™ ëª¨ë“œ í…ŒìŠ¤íŠ¸</button>
                <button onclick="testManualMode()">âš™ï¸ ìˆ˜ë™ ëª¨ë“œ í…ŒìŠ¤íŠ¸</button>
                <button onclick="testNoUrlMode()">âŒ URL ì—†ëŠ” ìƒíƒœ í…ŒìŠ¤íŠ¸</button>
                <div id="init-mode-result" class="result info">í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
            </div>

            <!-- ì„¤ì • í™”ë©´ í‘œì‹œ í…ŒìŠ¤íŠ¸ -->
            <div class="test-card">
                <h3>2. ì„¤ì • í™”ë©´ í‘œì‹œ í…ŒìŠ¤íŠ¸</h3>
                <button onclick="showSetupScreenTest()">ğŸ”§ ì„¤ì • í™”ë©´ ì—´ê¸°</button>
                <button onclick="hideSetupScreenTest()">ğŸ”’ ì„¤ì • í™”ë©´ ë‹«ê¸°</button>
                <button onclick="testSetupScreenWithSavedUrl()">ğŸ’¾ ì €ì¥ëœ URLë¡œ ì—´ê¸°</button>
                <div id="setup-screen-result" class="result info">ì„¤ì • í™”ë©´ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤</div>
            </div>

            <!-- URL ê²€ì¦ ë° ì—°ê²° í…ŒìŠ¤íŠ¸ -->
            <div class="test-card">
                <h3>3. URL ê²€ì¦ ë° ì—°ê²° í…ŒìŠ¤íŠ¸</h3>
                <input type="text" id="test-url-input" placeholder="Apps Script URL ì…ë ¥">
                <button onclick="testUrlValidationInSetup()">âœ… URL ê²€ì¦ í…ŒìŠ¤íŠ¸</button>
                <button onclick="testConnectionInSetup()">ğŸŒ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                <div id="url-validation-result" class="result info">URL ê²€ì¦ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
            </div>

            <!-- ìë™ ì´ˆê¸°í™” ì²´í¬ë°•ìŠ¤ í…ŒìŠ¤íŠ¸ -->
            <div class="test-card">
                <h3>4. ìë™ ì´ˆê¸°í™” ì²´í¬ë°•ìŠ¤ í…ŒìŠ¤íŠ¸</h3>
                <button onclick="testAutoInitCheckboxOn()">âœ… ì²´í¬ë°•ìŠ¤ ON</button>
                <button onclick="testAutoInitCheckboxOff()">âŒ ì²´í¬ë°•ìŠ¤ OFF</button>
                <button onclick="testAutoInitToggle()">ğŸ”„ í† ê¸€ í…ŒìŠ¤íŠ¸</button>
                <div id="checkbox-result" class="result info">ì²´í¬ë°•ìŠ¤ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤</div>
            </div>

            <!-- ë°ëª¨ ëª¨ë“œ í…ŒìŠ¤íŠ¸ -->
            <div class="test-card">
                <h3>5. ë°ëª¨ ëª¨ë“œ í…ŒìŠ¤íŠ¸</h3>
                <button onclick="testDemoModeStart()">ğŸ® ë°ëª¨ ëª¨ë“œ ì‹œì‘</button>
                <button onclick="testDemoModeCheck()">ğŸ“Š ë°ëª¨ ëª¨ë“œ ìƒíƒœ í™•ì¸</button>
                <div id="demo-mode-result" class="result info">ë°ëª¨ ëª¨ë“œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ì…ë‹ˆë‹¤</div>
            </div>

            <!-- ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ -->
            <div class="test-card">
                <h3>6. ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸</h3>
                <button onclick="testInvalidUrl()">ğŸš« ì˜ëª»ëœ URL ì²˜ë¦¬</button>
                <button onclick="testNetworkError()">ğŸŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬</button>
                <button onclick="testInitializationError()">âš ï¸ ì´ˆê¸°í™” ì˜¤ë¥˜ ì²˜ë¦¬</button>
                <div id="error-handling-result" class="result info">ì—ëŸ¬ ì²˜ë¦¬ ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤</div>
            </div>
        </div>

        <h2>7. í†µí•© ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</h2>
        <div class="test-card">
            <h3>ì „ì²´ ì‚¬ìš©ì í”Œë¡œìš° í…ŒìŠ¤íŠ¸</h3>
            <div id="scenario-steps">
                <div class="scenario-step" id="step-1">1. ì²« ë°©ë¬¸ (URL ì—†ìŒ) â†’ ì„¤ì • í™”ë©´ í‘œì‹œ</div>
                <div class="scenario-step" id="step-2">2. URL ì…ë ¥ ë° ê²€ì¦</div>
                <div class="scenario-step" id="step-3">3. ìë™ ì´ˆê¸°í™” ì„¤ì •</div>
                <div class="scenario-step" id="step-4">4. ì—°ê²° ë° ì´ˆê¸°í™”</div>
                <div class="scenario-step" id="step-5">5. ì¬ë°©ë¬¸ ì‹œ ìë™ ì´ˆê¸°í™”</div>
            </div>
            <button onclick="runIntegratedScenario()" id="scenario-btn">ğŸš€ ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰</button>
            <div id="integrated-scenario-result" class="result info">í†µí•© ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ ê²°ê³¼ì…ë‹ˆë‹¤</div>
        </div>

        <h2>8. ì‹¤ì‹œê°„ ì•± í…ŒìŠ¤íŠ¸</h2>
        <div class="test-card">
            <h3>ì‹¤ì œ ì•± ë™ì‘ í™•ì¸</h3>
            <p>ì•„ë˜ iframeì—ì„œ ì‹¤ì œ ì•±ì˜ Phase 2 êµ¬í˜„ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
            <div class="iframe-container">
                <iframe src="index.html" title="Virtual Data App - Phase 2"></iframe>
            </div>
            <button onclick="reloadApp()">ğŸ”„ ì•± ìƒˆë¡œê³ ì¹¨</button>
            <button onclick="clearAppStorage()">ğŸ—‘ï¸ ì €ì¥ì†Œ ì´ˆê¸°í™”</button>
        </div>

        <h2>9. ì‹¤ì‹œê°„ ë¡œê·¸</h2>
        <div class="log-area" id="log-area">
            > Phase 2 í…ŒìŠ¤íŠ¸ í™˜ê²½ ì¤€ë¹„ ì™„ë£Œ...<br>
        </div>
    </div>

    <script>
        // ë¡œê·¸ í•¨ìˆ˜
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('log-area');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#94a3b8';
            logArea.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span><br>`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        // Phase 1ì—ì„œ êµ¬í˜„ëœ í•¨ìˆ˜ë“¤ (ê°„ì†Œí™” ë²„ì „)
        const APP_VERSION = 'v3.5.0-phase2';

        window.APP_CONFIG = {
            isInitialized: false,
            appsScriptUrl: null,
            autoInit: false,
            version: APP_VERSION,
            data: {},
            settings: { debugMode: false, autoSave: true, offlineMode: false },
            state: { lastConnection: null, connectionAttempts: 0, isOnline: navigator.onLine }
        };

        function validateAppsScriptUrl(url) {
            if (!url || typeof url !== 'string') return false;
            const pattern = /^https:\/\/script\.google\.com\/macros\/s\/[A-Za-z0-9_-]+\/exec$/;
            return pattern.test(url.trim());
        }

        function shouldAutoInit() {
            const savedUrl = localStorage.getItem('vd_appsScriptUrl');
            const autoInitFlag = localStorage.getItem('vd_autoInit');
            return !!(savedUrl && autoInitFlag === 'true' && validateAppsScriptUrl(savedUrl));
        }

        const ConfigManager = {
            saveAppsScriptUrl(url) {
                if (validateAppsScriptUrl(url)) {
                    localStorage.setItem('vd_appsScriptUrl', url);
                    localStorage.setItem('vd_lastSaved', new Date().toISOString());
                    window.APP_CONFIG.appsScriptUrl = url;
                    return true;
                }
                return false;
            },

            loadAppsScriptUrl() {
                const savedUrl = localStorage.getItem('vd_appsScriptUrl');
                if (savedUrl && validateAppsScriptUrl(savedUrl)) {
                    window.APP_CONFIG.appsScriptUrl = savedUrl;
                    return savedUrl;
                }
                return null;
            },

            setAutoInit(enabled) {
                localStorage.setItem('vd_autoInit', enabled ? 'true' : 'false');
                window.APP_CONFIG.autoInit = enabled;
            },

            clearConfig() {
                localStorage.removeItem('vd_appsScriptUrl');
                localStorage.removeItem('vd_autoInit');
                localStorage.removeItem('vd_lastSaved');
                window.APP_CONFIG.appsScriptUrl = null;
                window.APP_CONFIG.autoInit = false;
            },

            updateConnectionState(success) {
                const now = new Date().toISOString();
                if (success) {
                    window.APP_CONFIG.state.lastConnection = now;
                    window.APP_CONFIG.state.connectionAttempts = 0;
                    localStorage.setItem('vd_lastConnection', now);
                } else {
                    window.APP_CONFIG.state.connectionAttempts++;
                }
            }
        };

        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function testAutoMode() {
            const result = document.getElementById('init-mode-result');
            addLog('ìë™ ëª¨ë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');

            // í…ŒìŠ¤íŠ¸ìš© ì„¤ì •
            const testUrl = 'https://script.google.com/macros/s/AKfycbwdwVRj8FrFA5XvdNx8ERp6YrGMTFjNQ8UmBIIevi1CNu_isLUok4TLsGtclns2ty0j/exec';
            ConfigManager.saveAppsScriptUrl(testUrl);
            ConfigManager.setAutoInit(true);

            const shouldInit = shouldAutoInit();

            result.className = 'result ' + (shouldInit ? 'success' : 'error');
            result.textContent = `ìë™ ì´ˆê¸°í™” ì¡°ê±´: ${shouldInit ? 'ë§Œì¡±' : 'ë¶ˆë§Œì¡±'}\nURL: ${window.APP_CONFIG.appsScriptUrl ? 'ì„¤ì •ë¨' : 'ë¯¸ì„¤ì •'}\nAutoInit: ${window.APP_CONFIG.autoInit}`;

            addLog(`ìë™ ëª¨ë“œ í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${shouldInit}`, shouldInit ? 'success' : 'error');
        }

        function testManualMode() {
            const result = document.getElementById('init-mode-result');
            addLog('ìˆ˜ë™ ëª¨ë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');

            // ìë™ ì´ˆê¸°í™” ë¹„í™œì„±í™”
            ConfigManager.setAutoInit(false);
            const shouldInit = shouldAutoInit();

            result.className = 'result info';
            result.textContent = `ìˆ˜ë™ ëª¨ë“œ ì„¤ì • ì™„ë£Œ\nìë™ ì´ˆê¸°í™”: ${shouldInit ? 'í™œì„±' : 'ë¹„í™œì„±'}\nìƒíƒœ: ìˆ˜ë™ ì´ˆê¸°í™” í•„ìš”`;

            addLog('ìˆ˜ë™ ëª¨ë“œë¡œ ì„¤ì • ì™„ë£Œ', 'success');
        }

        function testNoUrlMode() {
            const result = document.getElementById('init-mode-result');
            addLog('URL ì—†ëŠ” ìƒíƒœ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');

            // ëª¨ë“  ì„¤ì • ì‚­ì œ
            ConfigManager.clearConfig();
            const shouldInit = shouldAutoInit();

            result.className = 'result error';
            result.textContent = `ì„¤ì • ì—†ìŒ ìƒíƒœ\nìë™ ì´ˆê¸°í™”: ${shouldInit ? 'ê°€ëŠ¥' : 'ë¶ˆê°€ëŠ¥'}\nìƒíƒœ: ì„¤ì • í™”ë©´ í‘œì‹œ í•„ìš”`;

            addLog('URL ì—†ëŠ” ìƒíƒœë¡œ ì„¤ì •ë¨ - ì„¤ì • í™”ë©´ í•„ìš”', 'error');
        }

        function showSetupScreenTest() {
            const result = document.getElementById('setup-screen-result');
            addLog('ì„¤ì • í™”ë©´ í‘œì‹œ í…ŒìŠ¤íŠ¸', 'info');

            // ì‹œë®¬ë ˆì´ì…˜
            result.className = 'result success';
            result.textContent = 'âœ… ì„¤ì • í™”ë©´ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤\nìƒíƒœ: ì‚¬ìš©ì ì…ë ¥ ëŒ€ê¸° ì¤‘';

            addLog('ì„¤ì • í™”ë©´ í‘œì‹œ ì™„ë£Œ', 'success');
        }

        function hideSetupScreenTest() {
            const result = document.getElementById('setup-screen-result');
            addLog('ì„¤ì • í™”ë©´ ìˆ¨ê¸°ê¸° í…ŒìŠ¤íŠ¸', 'info');

            result.className = 'result info';
            result.textContent = 'ğŸ”’ ì„¤ì • í™”ë©´ì´ ìˆ¨ê²¨ì¡ŒìŠµë‹ˆë‹¤\nìƒíƒœ: ë©”ì¸ ì•± ì‹¤í–‰ ì¤‘';

            addLog('ì„¤ì • í™”ë©´ ìˆ¨ê¹€ ì™„ë£Œ', 'success');
        }

        function testSetupScreenWithSavedUrl() {
            const result = document.getElementById('setup-screen-result');
            addLog('ì €ì¥ëœ URLë¡œ ì„¤ì • í™”ë©´ ì—´ê¸° í…ŒìŠ¤íŠ¸', 'info');

            // í…ŒìŠ¤íŠ¸ìš© URL ì €ì¥
            const testUrl = 'https://script.google.com/macros/s/AKfycbwdwVRj8FrFA5XvdNx8ERp6YrGMTFjNQ8UmBIIevi1CNu_isLUok4TLsGtclns2ty0j/exec';
            ConfigManager.saveAppsScriptUrl(testUrl);

            result.className = 'result success';
            result.textContent = `âœ… ì €ì¥ëœ URLë¡œ ì„¤ì • í™”ë©´ ì—´ë¦¼\nURL: ${testUrl.substring(0, 50)}...\nìƒíƒœ: ê¸°ì¡´ ì„¤ì • í‘œì‹œë¨`;

            addLog('ì €ì¥ëœ URLë¡œ ì„¤ì • í™”ë©´ ì—´ê¸° ì™„ë£Œ', 'success');
        }

        function testUrlValidationInSetup() {
            const urlInput = document.getElementById('test-url-input');
            const result = document.getElementById('url-validation-result');
            const url = urlInput.value.trim();

            addLog(`URL ê²€ì¦ í…ŒìŠ¤íŠ¸: ${url}`, 'info');

            if (!url) {
                result.className = 'result error';
                result.textContent = 'âŒ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
                addLog('URL ì…ë ¥ ì—†ìŒ', 'error');
                return;
            }

            const isValid = validateAppsScriptUrl(url);

            result.className = 'result ' + (isValid ? 'success' : 'error');
            result.textContent = isValid ?
                `âœ… ì˜¬ë°”ë¥¸ Apps Script URLì…ë‹ˆë‹¤\n${url}` :
                `âŒ ì˜ëª»ëœ URL í˜•ì‹ì…ë‹ˆë‹¤\n${url}`;

            addLog(`URL ê²€ì¦ ê²°ê³¼: ${isValid}`, isValid ? 'success' : 'error');
        }

        function testConnectionInSetup() {
            const urlInput = document.getElementById('test-url-input');
            const result = document.getElementById('url-validation-result');
            const url = urlInput.value.trim();

            if (!url || !validateAppsScriptUrl(url)) {
                result.className = 'result error';
                result.textContent = 'âŒ ë¨¼ì € ì˜¬ë°”ë¥¸ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
                return;
            }

            addLog(`ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘: ${url}`, 'info');

            result.className = 'result info';
            result.textContent = 'ğŸŒ ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...';

            // ì‹¤ì œ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
            setTimeout(async () => {
                try {
                    const response = await fetch(url + '?test=true', {
                        method: 'GET',
                        mode: 'cors'
                    });

                    if (response.ok) {
                        result.className = 'result success';
                        result.textContent = 'âœ… ì—°ê²° ì„±ê³µ!\nì´ URLì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤';
                        addLog('ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ', 'success');
                    } else {
                        result.className = 'result error';
                        result.textContent = `âŒ ì—°ê²° ì‹¤íŒ¨ (HTTP ${response.status})`;
                        addLog(`ì—°ê²° ì‹¤íŒ¨: HTTP ${response.status}`, 'error');
                    }
                } catch (error) {
                    result.className = 'result error';
                    result.textContent = `âŒ ì—°ê²° ì˜¤ë¥˜: ${error.message}`;
                    addLog(`ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
                }
            }, 1000);
        }

        function testAutoInitCheckboxOn() {
            const result = document.getElementById('checkbox-result');
            addLog('ìë™ ì´ˆê¸°í™” ì²´í¬ë°•ìŠ¤ ON í…ŒìŠ¤íŠ¸', 'info');

            ConfigManager.setAutoInit(true);

            result.className = 'result success';
            result.textContent = 'âœ… ìë™ ì´ˆê¸°í™”ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤\nìƒíƒœ: ë‹¤ìŒ ë°©ë¬¸ ì‹œ ìë™ ì—°ê²°';

            addLog('ìë™ ì´ˆê¸°í™” ì²´í¬ë°•ìŠ¤ ON', 'success');
        }

        function testAutoInitCheckboxOff() {
            const result = document.getElementById('checkbox-result');
            addLog('ìë™ ì´ˆê¸°í™” ì²´í¬ë°•ìŠ¤ OFF í…ŒìŠ¤íŠ¸', 'info');

            ConfigManager.setAutoInit(false);

            result.className = 'result info';
            result.textContent = 'âŒ ìë™ ì´ˆê¸°í™”ê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤\nìƒíƒœ: ë§¤ë²ˆ ì„¤ì • í™”ë©´ í‘œì‹œ';

            addLog('ìë™ ì´ˆê¸°í™” ì²´í¬ë°•ìŠ¤ OFF', 'success');
        }

        function testAutoInitToggle() {
            const result = document.getElementById('checkbox-result');
            addLog('ìë™ ì´ˆê¸°í™” í† ê¸€ í…ŒìŠ¤íŠ¸', 'info');

            const currentState = localStorage.getItem('vd_autoInit') === 'true';
            ConfigManager.setAutoInit(!currentState);

            result.className = 'result success';
            result.textContent = `ğŸ”„ í† ê¸€ ì™„ë£Œ: ${currentState ? 'ON â†’ OFF' : 'OFF â†’ ON'}\ní˜„ì¬ ìƒíƒœ: ${!currentState ? 'ìë™' : 'ìˆ˜ë™'}`;

            addLog(`í† ê¸€ ì™„ë£Œ: ${!currentState}`, 'success');
        }

        function testDemoModeStart() {
            const result = document.getElementById('demo-mode-result');
            addLog('ë°ëª¨ ëª¨ë“œ ì‹œì‘ í…ŒìŠ¤íŠ¸', 'info');

            // ë°ëª¨ ëª¨ë“œ ì‹œë®¬ë ˆì´ì…˜
            window.APP_CONFIG.isInitialized = true;
            window.APP_CONFIG.appsScriptUrl = 'demo-mode';

            result.className = 'result success';
            result.textContent = 'ğŸ® ë°ëª¨ ëª¨ë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤\nìƒíƒœ: ë”ë¯¸ ë°ì´í„°ë¡œ ì‹¤í–‰ ì¤‘\nURL: demo-mode';

            addLog('ë°ëª¨ ëª¨ë“œ ì‹œì‘ ì™„ë£Œ', 'success');
        }

        function testDemoModeCheck() {
            const result = document.getElementById('demo-mode-result');
            addLog('ë°ëª¨ ëª¨ë“œ ìƒíƒœ í™•ì¸', 'info');

            const isDemo = window.APP_CONFIG.appsScriptUrl === 'demo-mode';

            result.className = 'result info';
            result.textContent = `ğŸ“Š ë°ëª¨ ëª¨ë“œ ìƒíƒœ: ${isDemo ? 'ON' : 'OFF'}\nì´ˆê¸°í™” ìƒíƒœ: ${window.APP_CONFIG.isInitialized ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}\nURL: ${window.APP_CONFIG.appsScriptUrl || 'ì—†ìŒ'}`;

            addLog(`ë°ëª¨ ëª¨ë“œ ìƒíƒœ: ${isDemo}`, 'success');
        }

        function testInvalidUrl() {
            const result = document.getElementById('error-handling-result');
            addLog('ì˜ëª»ëœ URL ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸', 'info');

            const invalidUrl = 'https://invalid-url.com';
            const isValid = validateAppsScriptUrl(invalidUrl);

            result.className = 'result success';
            result.textContent = `âœ… ì˜ëª»ëœ URLì´ ì˜¬ë°”ë¥´ê²Œ ì°¨ë‹¨ë¨\nURL: ${invalidUrl}\nê²€ì¦ ê²°ê³¼: ${isValid ? 'PASS (ì˜¤ë¥˜!)' : 'REJECT (ì •ìƒ)'}`;

            addLog(`ì˜ëª»ëœ URL ì°¨ë‹¨: ${!isValid}`, isValid ? 'error' : 'success');
        }

        function testNetworkError() {
            const result = document.getElementById('error-handling-result');
            addLog('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸', 'info');

            // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œë®¬ë ˆì´ì…˜
            fetch('https://invalid-domain-12345.com')
                .catch(error => {
                    result.className = 'result success';
                    result.textContent = `âœ… ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬ë¨\nì˜¤ë¥˜ íƒ€ì…: ${error.name}\në©”ì‹œì§€: ${error.message}`;
                    addLog('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬ ì™„ë£Œ', 'success');
                });

            result.className = 'result info';
            result.textContent = 'ğŸŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸ ì¤‘...';
        }

        function testInitializationError() {
            const result = document.getElementById('error-handling-result');
            addLog('ì´ˆê¸°í™” ì˜¤ë¥˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸', 'info');

            try {
                // ì˜ë„ì  ì˜¤ë¥˜ ë°œìƒ
                throw new Error('í…ŒìŠ¤íŠ¸ìš© ì´ˆê¸°í™” ì˜¤ë¥˜');
            } catch (error) {
                result.className = 'result success';
                result.textContent = `âœ… ì´ˆê¸°í™” ì˜¤ë¥˜ê°€ ì˜¬ë°”ë¥´ê²Œ ìºì¹˜ë¨\nì˜¤ë¥˜ ë©”ì‹œì§€: ${error.message}\nì²˜ë¦¬: ì—ëŸ¬ í•¸ë“¤ëŸ¬ ë™ì‘`;
                addLog('ì´ˆê¸°í™” ì˜¤ë¥˜ ì²˜ë¦¬ ì™„ë£Œ', 'success');
            }
        }

        function runIntegratedScenario() {
            addLog('=== í†µí•© ì‹œë‚˜ë¦¬ì˜¤ ì‹œì‘ ===', 'info');
            const scenarioBtn = document.getElementById('scenario-btn');
            const result = document.getElementById('integrated-scenario-result');

            scenarioBtn.disabled = true;
            scenarioBtn.textContent = 'ì‹¤í–‰ ì¤‘...';

            let currentStep = 1;

            function activateStep(stepNum) {
                document.querySelectorAll('.scenario-step').forEach(step => {
                    step.classList.remove('active', 'completed');
                });

                for (let i = 1; i < stepNum; i++) {
                    document.getElementById(`step-${i}`).classList.add('completed');
                }
                document.getElementById(`step-${stepNum}`).classList.add('active');
            }

            function nextStep() {
                return new Promise(resolve => {
                    setTimeout(() => {
                        switch(currentStep) {
                            case 1:
                                addLog('1. ì„¤ì • ì´ˆê¸°í™” - URL ì—†ëŠ” ìƒíƒœë¡œ ì„¤ì •', 'info');
                                ConfigManager.clearConfig();
                                activateStep(1);
                                break;
                            case 2:
                                addLog('2. URL ì…ë ¥ ë° ê²€ì¦', 'info');
                                const testUrl = 'https://script.google.com/macros/s/AKfycbwdwVRj8FrFA5XvdNx8ERp6YrGMTFjNQ8UmBIIevi1CNu_isLUok4TLsGtclns2ty0j/exec';
                                ConfigManager.saveAppsScriptUrl(testUrl);
                                activateStep(2);
                                break;
                            case 3:
                                addLog('3. ìë™ ì´ˆê¸°í™” ì„¤ì •', 'info');
                                ConfigManager.setAutoInit(true);
                                activateStep(3);
                                break;
                            case 4:
                                addLog('4. ì—°ê²° ë° ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸', 'info');
                                window.APP_CONFIG.isInitialized = true;
                                activateStep(4);
                                break;
                            case 5:
                                addLog('5. ìë™ ì´ˆê¸°í™” ì¡°ê±´ í™•ì¸', 'info');
                                const shouldInit = shouldAutoInit();
                                activateStep(5);
                                addLog(`ìµœì¢… ìë™ ì´ˆê¸°í™” ê°€ëŠ¥: ${shouldInit}`, shouldInit ? 'success' : 'error');
                                break;
                        }
                        currentStep++;
                        resolve();
                    }, 1000);
                });
            }

            async function runScenario() {
                for (let i = 0; i < 5; i++) {
                    await nextStep();
                }

                document.querySelectorAll('.scenario-step').forEach(step => {
                    step.classList.remove('active');
                    step.classList.add('completed');
                });

                result.className = 'result success';
                result.textContent = 'âœ… í†µí•© ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ!\nëª¨ë“  ë‹¨ê³„ê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.';

                scenarioBtn.disabled = false;
                scenarioBtn.textContent = 'ğŸš€ ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰';

                addLog('=== í†µí•© ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ ===', 'success');
            }

            runScenario();
        }

        function reloadApp() {
            const iframe = document.querySelector('.iframe-container iframe');
            if (iframe) {
                iframe.src = iframe.src;
                addLog('ì•± ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ', 'success');
            }
        }

        function clearAppStorage() {
            ConfigManager.clearConfig();
            // iframeì˜ localStorageë„ í´ë¦¬ì–´í•´ì•¼ í•˜ì§€ë§Œ, ë³´ì•ˆìƒ ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€
            addLog('ë¡œì»¬ ì €ì¥ì†Œ ì´ˆê¸°í™” ì™„ë£Œ (iframeì€ ìƒˆë¡œê³ ì¹¨ í•„ìš”)', 'success');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', () => {
            addLog('Phase 2 í…ŒìŠ¤íŠ¸ í™˜ê²½ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
            addLog('ëª¨ë“  í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ', 'info');
        });
    </script>
</body>
</html>