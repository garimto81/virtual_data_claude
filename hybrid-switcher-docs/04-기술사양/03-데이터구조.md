# 데이터 구조

## 1. 핵심 데이터 모델

### 1.1 게임 세션 (GameSession)
```typescript
interface GameSession {
  id: UUID;
  tableId: number;
  startedAt: Date;
  endedAt?: Date;
  status: SessionStatus;
  config: GameConfig;
  statistics: SessionStatistics;
}

enum SessionStatus {
  PREPARING = 'PREPARING',
  ACTIVE = 'ACTIVE',
  PAUSED = 'PAUSED',
  COMPLETED = 'COMPLETED'
}

interface GameConfig {
  maxPlayers: number;
  smallBlind: number;
  bigBlind: number;
  ante?: number;
  gameType: 'NLHE' | 'PLO' | 'MIXED';
  autoProgress: boolean;
}
```

### 1.2 플레이어 (Player)
```typescript
interface Player {
  sessionId: UUID;
  seat: number;
  name: string;
  stack: number;
  status: PlayerStatus;
  position?: Position;
  cards?: Card[];
  statistics: PlayerStatistics;
}

enum PlayerStatus {
  WAITING = 'WAITING',
  ACTIVE = 'ACTIVE',
  FOLDED = 'FOLDED',
  ALL_IN = 'ALL_IN',
  SITTING_OUT = 'SITTING_OUT'
}

enum Position {
  BTN = 'BTN',
  SB = 'SB',
  BB = 'BB',
  UTG = 'UTG',
  MP = 'MP',
  CO = 'CO'
}
```

### 1.3 게임 상태 (GameState)
```typescript
interface GameState {
  sessionId: UUID;
  handNumber: number;
  street: Street;
  pot: PotInfo;
  board: Card[];
  currentPlayer: number;
  dealerPosition: number;
  lastAggressor?: number;
  bettingRound: BettingRound;
}

enum Street {
  PREFLOP = 'PREFLOP',
  FLOP = 'FLOP',
  TURN = 'TURN',
  RIVER = 'RIVER',
  SHOWDOWN = 'SHOWDOWN'
}

interface PotInfo {
  main: number;
  side: SidePot[];
  total: number;
}

interface SidePot {
  amount: number;
  eligiblePlayers: number[];
}
```

## 2. 액션 데이터

### 2.1 액션 (Action)
```typescript
interface Action {
  id: string;
  sessionId: UUID;
  handNumber: number;
  timestamp: Date;
  player: number;
  type: ActionType;
  amount?: number;
  street: Street;
  metadata?: ActionMetadata;
}

enum ActionType {
  FOLD = 'FOLD',
  CHECK = 'CHECK',
  CALL = 'CALL',
  BET = 'BET',
  RAISE = 'RAISE',
  ALL_IN = 'ALL_IN',
  POST_SB = 'POST_SB',
  POST_BB = 'POST_BB'
}

interface ActionMetadata {
  isVoluntary: boolean;
  timeToAct?: number;
  previousAction?: string;
  potOdds?: number;
}
```

### 2.2 베팅 라운드 (BettingRound)
```typescript
interface BettingRound {
  street: Street;
  actions: Action[];
  currentBet: number;
  minRaise: number;
  playersToAct: number[];
  isComplete: boolean;
}
```

## 3. 하드웨어 인터페이스 데이터

### 3.1 LED 상태 (LEDState)
```typescript
interface LEDState {
  buttonId: number;
  color: LEDColor;
  pattern: LEDPattern;
  brightness: number; // 0-100
}

enum LEDColor {
  OFF = 0x00,
  GREEN = 0x01,
  RED = 0x02,
  BLUE = 0x04,
  YELLOW = 0x03,
  WHITE = 0x07
}

enum LEDPattern {
  SOLID = 'SOLID',
  BLINK_SLOW = 'BLINK_SLOW',    // 1Hz
  BLINK_FAST = 'BLINK_FAST',    // 2Hz
  PULSE = 'PULSE',              // Breathing effect
  FLASH = 'FLASH'               // Quick flash
}
```

### 3.2 버튼 입력 (ButtonInput)
```typescript
interface ButtonInput {
  timestamp: number;
  buttonId: number;
  type: ButtonType;
  event: ButtonEvent;
  modifiers?: ButtonModifier[];
}

enum ButtonType {
  STATUS = 'STATUS',      // 1st row
  ACTION = 'ACTION',      // 4th row
  SPECIAL = 'SPECIAL'     // System buttons
}

enum ButtonEvent {
  PRESS = 'PRESS',
  RELEASE = 'RELEASE',
  HOLD = 'HOLD',
  DOUBLE_CLICK = 'DOUBLE_CLICK'
}
```

## 4. 카메라 시스템 데이터

### 4.1 카메라 설정 (CameraSettings)
```typescript
interface CameraSettings {
  cameraId: number;
  name: string;
  type: CameraType;
  connection: ConnectionInfo;
  capabilities: CameraCapabilities;
  currentPosition: PTZPosition;
}

interface PTZPosition {
  pan: number;      // -180 to 180
  tilt: number;     // -90 to 90
  zoom: number;     // 1 to 30
  focus?: number;   // 0 to 100
}

interface CameraCapabilities {
  hasPTZ: boolean;
  hasAutoFocus: boolean;
  maxZoom: number;
  presetCount: number;
  protocols: string[];
}
```

### 4.2 카메라 프리셋 (CameraPreset)
```typescript
interface CameraPreset {
  id: string;
  name: string;
  cameraId: number;
  position: PTZPosition;
  transitionTime: number;
  audioConfig?: AudioPreset;
  metadata: PresetMetadata;
}

interface PresetMetadata {
  usage: PresetUsage[];
  priority: number;
  tags: string[];
}

enum PresetUsage {
  PLAYER_CLOSEUP = 'PLAYER_CLOSEUP',
  TABLE_WIDE = 'TABLE_WIDE',
  DEALER_VIEW = 'DEALER_VIEW',
  SHOWDOWN = 'SHOWDOWN',
  HIGHLIGHT = 'HIGHLIGHT'
}
```

## 5. 통계 데이터

### 5.1 세션 통계 (SessionStatistics)
```typescript
interface SessionStatistics {
  sessionId: UUID;
  duration: number;
  handsPlayed: number;
  totalPot: number;
  avgPotSize: number;
  largestPot: number;
  playerStatistics: Map<number, PlayerStatistics>;
  systemMetrics: SystemMetrics;
}

interface PlayerStatistics {
  seat: number;
  handsPlayed: number;
  vpip: number;          // Voluntarily Put In Pot %
  pfr: number;           // Pre-Flop Raise %
  aggression: number;    // Aggression Factor
  winRate: number;
  showdownWinRate: number;
  totalWinnings: number;
}
```

### 5.2 시스템 메트릭 (SystemMetrics)
```typescript
interface SystemMetrics {
  timestamp: Date;
  performance: PerformanceMetrics;
  reliability: ReliabilityMetrics;
  usage: UsageMetrics;
}

interface PerformanceMetrics {
  avgLatency: number;
  p95Latency: number;
  p99Latency: number;
  throughput: number;
  cpuUsage: number;
  memoryUsage: number;
}

interface ReliabilityMetrics {
  uptime: number;
  errorRate: number;
  recoveryTime: number;
  failureCount: number;
}
```

## 6. 이벤트 시스템 데이터

### 6.1 시스템 이벤트 (SystemEvent)
```typescript
interface SystemEvent {
  id: string;
  type: EventType;
  source: EventSource;
  timestamp: Date;
  data: any;
  metadata: EventMetadata;
}

enum EventType {
  // Game Events
  HAND_START = 'HAND_START',
  STREET_CHANGE = 'STREET_CHANGE',
  ACTION_PERFORMED = 'ACTION_PERFORMED',
  HAND_COMPLETE = 'HAND_COMPLETE',
  
  // System Events
  CAMERA_SWITCH = 'CAMERA_SWITCH',
  AUDIO_CHANGE = 'AUDIO_CHANGE',
  ERROR_OCCURRED = 'ERROR_OCCURRED',
  STATE_SYNC = 'STATE_SYNC'
}

interface EventMetadata {
  priority: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';
  ttl?: number;
  retry?: boolean;
  correlationId?: string;
}
```

### 6.2 오류 이벤트 (ErrorEvent)
```typescript
interface ErrorEvent extends SystemEvent {
  error: ErrorInfo;
  recovery?: RecoveryInfo;
}

interface ErrorInfo {
  code: string;
  message: string;
  severity: ErrorSeverity;
  context: any;
  stackTrace?: string;
}

enum ErrorSeverity {
  WARNING = 'WARNING',
  ERROR = 'ERROR',
  CRITICAL = 'CRITICAL',
  FATAL = 'FATAL'
}

interface RecoveryInfo {
  strategy: RecoveryStrategy;
  attempts: number;
  success: boolean;
  recoveredAt?: Date;
}
```

## 7. 설정 데이터

### 7.1 시스템 설정 (SystemConfiguration)
```typescript
interface SystemConfiguration {
  version: string;
  environment: 'development' | 'staging' | 'production';
  features: FeatureFlags;
  limits: SystemLimits;
  integrations: IntegrationConfig[];
}

interface FeatureFlags {
  autoProgress: boolean;
  undoEnabled: boolean;
  multiTableSupport: boolean;
  aiAssistance: boolean;
  advancedAnalytics: boolean;
}

interface SystemLimits {
  maxTables: number;
  maxPlayersPerTable: number;
  maxUndoSteps: number;
  sessionTimeout: number;
  actionTimeout: number;
}
```

### 7.2 사용자 설정 (UserPreferences)
```typescript
interface UserPreferences {
  userId: string;
  ui: UIPreferences;
  shortcuts: KeyboardShortcuts;
  notifications: NotificationSettings;
  audio: AudioSettings;
}

interface UIPreferences {
  theme: 'light' | 'dark' | 'auto';
  language: string;
  buttonLayout: 'default' | 'compact' | 'custom';
  colorScheme: ColorScheme;
}

interface KeyboardShortcuts {
  actions: Map<string, ActionType>;
  cameras: Map<string, number>;
  special: Map<string, string>;
}
```