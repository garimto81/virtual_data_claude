# 시스템 아키텍처

## 1. 아키텍처 개요

### 1.1 하이브리드 아키텍처
```
┌─────────────────────────────────────────────────────────┐
│                    Presentation Layer                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │  상태 표시  │  │  제어 버튼  │  │  모니터링   │    │
│  │   (1열)     │  │   (4열)     │  │    UI       │    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────┐
│                    Business Logic Layer                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ Game State  │  │   Action    │  │  Algorithm  │    │
│  │  Manager    │  │  Processor  │  │   Engine    │    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────┐
│                      Data Layer                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   State     │  │   Event     │  │   Config    │    │
│  │   Store     │  │    Log      │  │   Store     │    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────┐
│                   Integration Layer                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Camera    │  │   Audio     │  │  External   │    │
│  │   Control   │  │   Mixer     │  │    APIs     │    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────┘
```

### 1.2 핵심 설계 원칙
- **물리적 분리**: 위치 확인과 액션 실행의 완전한 분리
- **실시간 동기화**: 모든 구성요소 간 50ms 이내 동기화
- **장애 격리**: 컴포넌트 장애가 전체 시스템에 영향 없음
- **수평적 확장**: 테이블 수 증가에 따른 선형적 확장

## 2. 주요 컴포넌트

### 2.1 Presentation Layer
#### 상태 표시 패널 (1열)
- 테이블 좌석과 1:1 매핑
- LED 기반 시각적 피드백
- 실시간 게임 상태 표시

#### 제어 버튼 패널 (4열)
- 인체공학적 버튼 배치
- 촉각 피드백 지원
- 다중 입력 방지

#### 모니터링 UI
- 실시간 시스템 상태
- 성능 메트릭 표시
- 에러 알림

### 2.2 Business Logic Layer
#### Game State Manager
- 게임 상태 추적 및 관리
- 규칙 검증
- 상태 전환 제어

#### Action Processor
- 사용자 입력 처리
- 액션 검증
- 명령 큐 관리

#### Algorithm Engine
- Last Aggressor 알고리즘
- 자동 진행 로직
- 예측 분석

### 2.3 Data Layer
#### State Store
- In-memory 상태 저장
- Redis 기반 캐싱
- 상태 스냅샷

#### Event Log
- 모든 액션 기록
- 감사 추적
- 재생 기능

#### Config Store
- 시스템 설정
- 게임 규칙
- 사용자 프로파일

### 2.4 Integration Layer
#### Camera Control
- PTZ 카메라 제어
- 프리셋 관리
- 자동 추적

#### Audio Mixer
- 음성 채널 관리
- 자동 믹싱
- 노이즈 제거

#### External APIs
- 방송 시스템 연동
- 통계 시스템 연동
- 써드파티 통합

## 3. 데이터 흐름

### 3.1 입력 처리 흐름
```
사용자 입력 → 입력 검증 → 상태 확인 → 액션 실행 → 상태 업데이트 → UI 반영
     ↓                                            ↓
   로깅                                      외부 시스템 연동
```

### 3.2 상태 동기화 흐름
```
State Change → Event Bus → Subscribers → UI Update
      ↓            ↓            ↓
   Snapshot    Logging    External Sync
```

## 4. 성능 및 확장성

### 4.1 성능 목표
- 응답 시간: < 50ms
- 처리량: 1000 TPS
- 동시 접속: 100 테이블

### 4.2 확장 전략
- 마이크로서비스 아키텍처
- 컨테이너 기반 배포
- 로드 밸런싱

### 4.3 고가용성
- Active-Active 구성
- 자동 장애 조치
- 데이터 복제