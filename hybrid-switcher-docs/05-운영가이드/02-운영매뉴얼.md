# 운영 매뉴얼

## 1. 시스템 시작 및 종료

### 1.1 시스템 시작
```bash
# 1. 하드웨어 전원 확인
- 제어 패널 전원 ON
- 카메라 시스템 전원 ON
- 오디오 믹서 전원 ON

# 2. 소프트웨어 시작
cd /opt/switcher
docker-compose up -d

# 3. 서비스 확인
docker-compose ps
curl http://localhost:3000/health

# 4. 하드웨어 초기화
docker-compose exec backend npm run hardware:init
```

### 1.2 정상 종료
```bash
# 1. 현재 세션 확인
docker-compose exec backend npm run session:status

# 2. 세션 종료
docker-compose exec backend npm run session:end

# 3. 서비스 종료
docker-compose down

# 4. 하드웨어 안전 모드
docker-compose exec backend npm run hardware:safe-mode
```

## 2. 일상 운영

### 2.1 게임 세션 시작
#### 2.1.1 사전 점검
```
체크리스트:
□ 모든 LED 정상 작동
□ 버튼 입력 테스트 완료
□ 카메라 연결 확인
□ 오디오 레벨 체크
□ 네트워크 상태 정상
□ 백업 시스템 준비
```

#### 2.1.2 새 세션 생성
```
1. 관리자 패널 접속
2. "New Session" 클릭
3. 테이블 설정:
   - 플레이어 수
   - 블라인드 레벨
   - 게임 타입
4. "Start Session" 클릭
```

### 2.2 게임 진행
#### 2.2.1 기본 조작
| 상황 | 조작 | 결과 |
|------|------|------|
| 새 핸드 시작 | NEW HAND 버튼 | 딜러 버튼 이동, 블라인드 설정 |
| 플레이어 액션 | 해당 액션 버튼 | 상태 업데이트, 다음 플레이어로 |
| 스트리트 전환 | 자동 감지 | 카메라 전환, 상태 리셋 |
| 쇼다운 | 자동 진행 | Last Aggressor 포커스 |

#### 2.2.2 특수 상황 처리
```
올인 상황:
1. ALL-IN 버튼 클릭
2. 사이드 팟 자동 계산
3. 카메라 와이드 샷 전환
4. 남은 카드 딜링 대기

실수 정정:
1. UNDO 버튼 클릭
2. 이전 상태 확인
3. 올바른 액션 재입력
```

### 2.3 모니터링
#### 2.3.1 실시간 대시보드
```
주요 지표:
- 시스템 지연: < 50ms (정상: 녹색)
- CPU 사용률: < 60% (주의: 노란색)
- 메모리 사용: < 80% (경고: 빨간색)
- 활성 연결: 모든 장치 연결됨
```

#### 2.3.2 로그 확인
```bash
# 실시간 로그 모니터링
docker-compose logs -f backend

# 특정 레벨 로그 필터
docker-compose logs backend | grep ERROR

# 액션 로그 확인
tail -f /var/log/switcher/actions.log
```

## 3. 문제 상황 대응

### 3.1 일반적인 문제
#### LED 동작 불량
```
증상: LED가 깜빡이지 않거나 잘못된 색상 표시

해결:
1. 하드웨어 연결 확인
2. USB 케이블 재연결
3. LED 테스트 모드 실행:
   docker-compose exec backend npm run test:leds
4. 필요시 컨트롤러 재시작
```

#### 버튼 무반응
```
증상: 버튼 클릭해도 반응 없음

해결:
1. 버튼 잠금 상태 확인
2. 디바운싱 설정 확인
3. 입력 로그 확인:
   tail -f /var/log/switcher/input.log
4. 하드웨어 리셋
```

### 3.2 시스템 오류
#### 상태 동기화 실패
```
증상: UI와 실제 게임 상태 불일치

긴급 대응:
1. SYNC 버튼 클릭
2. 수동 상태 확인
3. 필요시 상태 수동 설정

근본 해결:
1. 네트워크 지연 확인
2. Redis 연결 상태 확인
3. 이벤트 버스 재시작
```

#### 카메라 연결 끊김
```
증상: 카메라 전환 실패 또는 검은 화면

해결:
1. 카메라 전원 및 네트워크 확인
2. 카메라 IP 주소 ping 테스트
3. 카메라 서비스 재시작:
   docker-compose restart camera-service
4. 수동 카메라 전환 모드 활성화
```

## 4. 백업 및 복구

### 4.1 수동 백업
```bash
# 전체 시스템 백업
/opt/switcher/scripts/manual-backup.sh

# 데이터베이스만 백업
docker-compose exec postgres pg_dump -U switcher switcher > backup_$(date +%Y%m%d).sql

# 설정 파일 백업
tar -czf config_backup_$(date +%Y%m%d).tar.gz /opt/switcher/config
```

### 4.2 복구 절차
```bash
# 1. 서비스 중단
docker-compose down

# 2. 데이터베이스 복구
docker-compose up -d postgres
docker-compose exec postgres psql -U switcher switcher < backup_20250801.sql

# 3. 설정 파일 복구
tar -xzf config_backup_20250801.tar.gz -C /

# 4. 서비스 재시작
docker-compose up -d
```

## 5. 성능 최적화

### 5.1 일일 유지보수
```bash
# 1. 로그 정리
find /var/log/switcher -name "*.log" -mtime +7 -delete

# 2. 데이터베이스 최적화
docker-compose exec postgres vacuumdb -U switcher -d switcher -z

# 3. Redis 메모리 정리
docker-compose exec redis redis-cli MEMORY PURGE

# 4. Docker 이미지 정리
docker system prune -f
```

### 5.2 성능 튜닝
```yaml
# 시스템 파라미터 조정
sysctl.conf:
  net.core.somaxconn: 1024
  net.ipv4.tcp_max_syn_backlog: 1024
  net.ipv4.tcp_fin_timeout: 15
  
# Redis 최적화
redis.conf:
  maxmemory: 2gb
  maxmemory-policy: allkeys-lru
  save: ""  # 디스크 저장 비활성화
```

## 6. 보안 관리

### 6.1 접근 제어
```bash
# 사용자 권한 확인
docker-compose exec backend npm run user:list

# 권한 변경
docker-compose exec backend npm run user:role --user=operator1 --role=admin

# 비밀번호 재설정
docker-compose exec backend npm run user:reset-password --user=operator1
```

### 6.2 보안 점검
```
일일 점검:
□ 비정상 로그인 시도 확인
□ API 접근 로그 검토
□ 시스템 리소스 사용률 확인

주간 점검:
□ 사용자 권한 감사
□ 보안 패치 확인
□ SSL 인증서 유효기간 확인
```

## 7. 교육 모드 운영

### 7.1 교육 세션 설정
```javascript
// 교육 모드 활성화
{
  "mode": "training",
  "features": {
    "hints": true,
    "slowMode": true,
    "undoLimit": 5,
    "autoCorrect": false
  }
}
```

### 7.2 교육 시나리오
```
1. 기본 조작 연습
   - 버튼 위치 숙지
   - LED 상태 이해
   - 액션 순서 연습

2. 실전 시뮬레이션
   - 실제 게임 상황 재현
   - 시간 제한 있는 연습
   - 오류 상황 대처

3. 평가 및 피드백
   - 정확도 측정
   - 반응 시간 분석
   - 개선점 제시
```

## 8. 리포트 생성

### 8.1 운영 리포트
```bash
# 일일 리포트
docker-compose exec backend npm run report:daily --date=2025-08-01

# 세션 리포트
docker-compose exec backend npm run report:session --id=session_123

# 성능 리포트
docker-compose exec backend npm run report:performance --range=week
```

### 8.2 통계 분석
```
주요 지표:
- 평균 핸드 시간
- 시간당 핸드 수
- 오류 발생률
- 시스템 가동률
- 운영자 효율성
```