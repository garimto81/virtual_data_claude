# 설치 및 설정

## 1. 시스템 요구사항

### 1.1 하드웨어 요구사항
#### 최소 사양
- CPU: Intel i5-10400 또는 동급
- RAM: 16GB DDR4
- Storage: 256GB SSD
- Network: 1Gb Ethernet
- USB: USB 3.0 포트 4개 이상

#### 권장 사양
- CPU: Intel i7-12700K 또는 동급
- RAM: 32GB DDR4
- Storage: 1TB NVMe SSD
- Network: 10Gb Ethernet
- USB: USB 3.0 포트 8개 이상

### 1.2 소프트웨어 요구사항
```yaml
운영체제:
  - Ubuntu 22.04 LTS (권장)
  - Ubuntu 20.04 LTS
  - Windows Server 2019/2022

런타임:
  - Node.js 18.x LTS
  - Python 3.10+
  - Docker 20.10+
  - Docker Compose 2.0+

데이터베이스:
  - PostgreSQL 15+
  - Redis 7.0+
```

## 2. 설치 과정

### 2.1 시스템 준비
```bash
# Ubuntu 시스템 업데이트
sudo apt update && sudo apt upgrade -y

# 필수 패키지 설치
sudo apt install -y curl wget git build-essential

# Docker 설치
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Docker Compose 설치
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### 2.2 애플리케이션 설치
```bash
# 저장소 클론
git clone https://github.com/example/hybrid-switcher.git
cd hybrid-switcher

# 환경 변수 설정
cp .env.example .env
nano .env  # 필요한 설정 수정

# Docker 이미지 빌드
docker-compose build

# 서비스 시작
docker-compose up -d
```

### 2.3 데이터베이스 초기화
```bash
# 데이터베이스 마이그레이션
docker-compose exec backend npm run migrate

# 초기 데이터 시딩
docker-compose exec backend npm run seed

# 관리자 계정 생성
docker-compose exec backend npm run create-admin
```

## 3. 하드웨어 설정

### 3.1 제어 패널 연결
```bash
# USB 장치 확인
lsusb | grep "Switcher Controller"

# 권한 설정
sudo usermod -a -G dialout $USER
sudo chmod 666 /dev/ttyUSB*

# udev 규칙 추가
echo 'SUBSYSTEM=="usb", ATTRS{idVendor}=="1234", ATTRS{idProduct}=="5678", MODE="0666"' | sudo tee /etc/udev/rules.d/99-switcher.rules
sudo udevadm control --reload-rules
```

### 3.2 카메라 시스템 연결
```yaml
# config/cameras.yml
cameras:
  - id: 1
    name: "Wide Shot"
    type: "NDI"
    address: "192.168.1.101"
    protocol: "NDI|HX2"
    
  - id: 2
    name: "Player Cam"
    type: "VISCA"
    address: "192.168.1.102"
    port: 5678
    
  - id: 3
    name: "Table Overview"
    type: "RTSP"
    url: "rtsp://192.168.1.103:554/stream1"
```

### 3.3 오디오 시스템 설정
```yaml
# config/audio.yml
audio:
  mixer:
    type: "DANTE"
    primary_interface: "eth1"
    sample_rate: 48000
    bit_depth: 24
    
  channels:
    - id: 1
      name: "Seat 1"
      input: "Dante 1"
      processing:
        - type: "gate"
          threshold: -40
        - type: "compressor"
          ratio: 3:1
```

## 4. 네트워크 설정

### 4.1 방화벽 규칙
```bash
# 필요한 포트 열기
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw allow 3000/tcp  # API Server
sudo ufw allow 5432/tcp  # PostgreSQL
sudo ufw allow 6379/tcp  # Redis
sudo ufw allow 8080/tcp  # WebSocket

# 방화벽 활성화
sudo ufw enable
```

### 4.2 NGINX 설정
```nginx
# /etc/nginx/sites-available/switcher
server {
    listen 80;
    server_name switcher.example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name switcher.example.com;
    
    ssl_certificate /etc/ssl/certs/switcher.crt;
    ssl_certificate_key /etc/ssl/private/switcher.key;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
    
    location /ws {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
    }
}
```

## 5. 시스템 설정

### 5.1 환경 변수 (.env)
```bash
# Application
NODE_ENV=production
PORT=3000
API_VERSION=v1

# Database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=switcher
DB_USER=switcher_user
DB_PASSWORD=secure_password

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=redis_password

# JWT
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRY=24h

# Camera System
CAMERA_API_ENDPOINT=http://camera-server:8000
CAMERA_AUTH_TOKEN=camera_token

# Audio System
AUDIO_MIXER_IP=192.168.1.200
AUDIO_PROTOCOL=DANTE

# Monitoring
ENABLE_METRICS=true
METRICS_PORT=9090
LOG_LEVEL=info
```

### 5.2 애플리케이션 설정
```json
// config/app.json
{
  "game": {
    "maxTables": 4,
    "maxPlayersPerTable": 9,
    "actionTimeout": 30000,
    "autoProgressDelay": 2000,
    "undoEnabled": true,
    "maxUndoSteps": 1
  },
  
  "ui": {
    "theme": "dark",
    "language": "en",
    "refreshRate": 60,
    "animationSpeed": "normal"
  },
  
  "camera": {
    "defaultTransition": "cut",
    "transitionDuration": 500,
    "autoSwitchEnabled": true,
    "presetLoadTime": 1000
  },
  
  "audio": {
    "masterVolume": 85,
    "micGainDefault": 70,
    "noiseGateThreshold": -40,
    "compressionRatio": 3
  }
}
```

## 6. 시스템 검증

### 6.1 서비스 상태 확인
```bash
# Docker 컨테이너 상태
docker-compose ps

# 서비스 헬스체크
curl http://localhost:3000/health

# 데이터베이스 연결 테스트
docker-compose exec backend npm run db:test

# WebSocket 연결 테스트
wscat -c ws://localhost:8080
```

### 6.2 하드웨어 테스트
```bash
# LED 테스트
docker-compose exec backend npm run test:leds

# 버튼 입력 테스트
docker-compose exec backend npm run test:buttons

# 카메라 연결 테스트
docker-compose exec backend npm run test:cameras

# 오디오 시스템 테스트
docker-compose exec backend npm run test:audio
```

## 7. 백업 설정

### 7.1 자동 백업 스크립트
```bash
#!/bin/bash
# /opt/switcher/backup.sh

BACKUP_DIR="/backup/switcher"
DATE=$(date +%Y%m%d_%H%M%S)

# 데이터베이스 백업
docker-compose exec -T postgres pg_dump -U $DB_USER $DB_NAME > "$BACKUP_DIR/db_$DATE.sql"

# 설정 파일 백업
tar -czf "$BACKUP_DIR/config_$DATE.tar.gz" /opt/switcher/config

# Redis 백업
docker-compose exec -T redis redis-cli BGSAVE

# 오래된 백업 삭제 (30일 이상)
find $BACKUP_DIR -type f -mtime +30 -delete
```

### 7.2 백업 스케줄 설정
```bash
# crontab -e
0 2 * * * /opt/switcher/backup.sh
0 */6 * * * docker-compose exec -T redis redis-cli BGSAVE
```

## 8. 모니터링 설정

### 8.1 Prometheus 설정
```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'switcher'
    static_configs:
      - targets: ['localhost:9090']
    metrics_path: '/metrics'
    scrape_interval: 5s
```

### 8.2 로그 설정
```yaml
# config/logging.yml
logging:
  level: info
  format: json
  outputs:
    - type: file
      path: /var/log/switcher/app.log
      rotate:
        size: 100M
        count: 10
    - type: syslog
      host: localhost
      port: 514
```