<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ° Virtual Data v4.0.0 Phoenix</title>

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ°</text></svg>">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Custom Styles -->
  <style>
    /* Phoenix Theme Variables */
    :root {
      --phoenix-primary: #ef4444;    /* Red */
      --phoenix-secondary: #f97316;  /* Orange */
      --phoenix-accent: #fbbf24;     /* Amber */
      --phoenix-success: #10b981;    /* Emerald */
      --phoenix-warning: #f59e0b;    /* Yellow */
      --phoenix-error: #dc2626;      /* Red-600 */
      --phoenix-dark: #1f2937;       /* Gray-800 */
      --phoenix-darker: #111827;     /* Gray-900 */
    }

    /* Phoenix Animation */
    @keyframes phoenix-rise {
      0% { opacity: 0; transform: translateY(20px) scale(0.9); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    @keyframes phoenix-glow {
      0%, 100% { box-shadow: 0 0 20px var(--phoenix-accent); }
      50% { box-shadow: 0 0 40px var(--phoenix-primary); }
    }

    .phoenix-rise { animation: phoenix-rise 0.6s ease-out; }
    .phoenix-glow { animation: phoenix-glow 2s infinite; }

    /* Loading Spinner */
    .loader {
      border: 4px solid #f3f4f6;
      border-top: 4px solid var(--phoenix-primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Module Cards */
    .module-card {
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .module-card:hover {
      transform: translateY(-2px);
      border-color: var(--phoenix-accent);
    }

    .module-card.active {
      border-color: var(--phoenix-primary);
      background: linear-gradient(135deg, var(--phoenix-dark) 0%, var(--phoenix-darker) 100%);
    }

    /* Status Indicators */
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
    }

    .status-loading { background: var(--phoenix-warning); animation: pulse 1s infinite; }
    .status-success { background: var(--phoenix-success); }
    .status-error { background: var(--phoenix-error); }
    .status-inactive { background: #6b7280; }

    /* Debug Panel */
    .debug-panel {
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      background: #0f172a;
      border: 1px solid #374151;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .desktop-only { display: none !important; }
      .mobile-full { width: 100% !important; }
    }
  </style>
</head>

<body class="bg-gray-900 text-white min-h-screen">
  <!-- Loading Screen -->
  <div id="loading-screen" class="fixed inset-0 bg-gray-900 flex items-center justify-center z-50">
    <div class="text-center">
      <div class="loader mx-auto mb-4"></div>
      <h1 class="text-3xl font-bold mb-2 phoenix-glow">ğŸ° Virtual Data</h1>
      <p class="text-xl text-orange-400 mb-4">v4.0.0 Phoenix</p>
      <p id="loading-status" class="text-gray-400">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...</p>
      <div class="mt-4 w-64 bg-gray-700 rounded-full h-2">
        <div id="loading-progress" class="bg-gradient-to-r from-red-500 to-orange-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
      </div>
    </div>
  </div>

  <!-- Main App Container -->
  <div id="app" class="hidden phoenix-rise">

    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700">
      <div class="container mx-auto px-4 py-3">
        <div class="flex items-center justify-between">
          <!-- Logo & Title -->
          <div class="flex items-center space-x-3">
            <span class="text-2xl">ğŸ°</span>
            <div>
              <h1 class="text-xl font-bold">Virtual Data Phoenix</h1>
              <p class="text-sm text-gray-400">v4.0.0 - ì™„ì „íˆ ìƒˆë¡œìš´ ëª¨ë“ˆí™” ì•„í‚¤í…ì²˜</p>
            </div>
          </div>

          <!-- Status & Controls -->
          <div class="flex items-center space-x-4 desktop-only">
            <div id="connection-status" class="flex items-center">
              <span class="status-dot status-inactive"></span>
              <span class="text-sm">ì—°ê²° í™•ì¸ ì¤‘...</span>
            </div>

            <button id="settings-btn" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">
              âš™ï¸ ì„¤ì •
            </button>

            <button id="debug-btn" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">
              ğŸ” ë””ë²„ê·¸
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">

      <!-- System Status -->
      <section class="mb-8">
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <h2 class="text-lg font-semibold mb-4 flex items-center">
            <span class="mr-2">ğŸ“Š</span>
            ì‹œìŠ¤í…œ ìƒíƒœ
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- App Status -->
            <div class="bg-gray-700 rounded-lg p-4">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-gray-400">ì• í”Œë¦¬ì¼€ì´ì…˜</span>
                <span id="app-status" class="status-dot status-loading"></span>
              </div>
              <div id="app-status-text" class="font-semibold">ì´ˆê¸°í™” ì¤‘...</div>
              <div id="app-uptime" class="text-xs text-gray-400">-</div>
            </div>

            <!-- Modules Status -->
            <div class="bg-gray-700 rounded-lg p-4">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-gray-400">ëª¨ë“ˆ</span>
                <span id="modules-count" class="text-sm font-mono">0/4</span>
              </div>
              <div id="modules-status" class="font-semibold">ë¡œë”© ì¤‘...</div>
              <div id="modules-list" class="text-xs text-gray-400">-</div>
            </div>

            <!-- API Status -->
            <div class="bg-gray-700 rounded-lg p-4">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-gray-400">API ì—°ê²°</span>
                <span id="api-status" class="status-dot status-inactive"></span>
              </div>
              <div id="api-status-text" class="font-semibold">í™•ì¸ ì¤‘...</div>
              <div id="api-url" class="text-xs text-gray-400 truncate">-</div>
            </div>

            <!-- Performance -->
            <div class="bg-gray-700 rounded-lg p-4">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-gray-400">ì„±ëŠ¥</span>
                <span id="perf-indicator" class="text-sm font-mono">-</span>
              </div>
              <div id="perf-status" class="font-semibold">ì¸¡ì • ì¤‘...</div>
              <div id="memory-usage" class="text-xs text-gray-400">-</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Module Grid -->
      <section class="mb-8">
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <h2 class="text-lg font-semibold mb-4 flex items-center">
            <span class="mr-2">ğŸ§©</span>
            ëª¨ë“ˆ ìƒíƒœ
          </h2>

          <div id="modules-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Modules will be populated dynamically -->
          </div>
        </div>
      </section>

      <!-- Quick Actions -->
      <section class="mb-8">
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <h2 class="text-lg font-semibold mb-4 flex items-center">
            <span class="mr-2">âš¡</span>
            ë¹ ë¥¸ ì‘ì—…
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <button id="setup-btn" class="bg-blue-600 hover:bg-blue-700 p-4 rounded-lg text-left transition-colors">
              <div class="text-lg font-semibold mb-2">ğŸ”§ ì´ˆê¸° ì„¤ì •</div>
              <div class="text-sm text-blue-200">Apps Script URL ë° ê¸°ë³¸ ì„¤ì •</div>
            </button>

            <button id="demo-btn" class="bg-purple-600 hover:bg-purple-700 p-4 rounded-lg text-left transition-colors">
              <div class="text-lg font-semibold mb-2">ğŸ® ë°ëª¨ ëª¨ë“œ</div>
              <div class="text-sm text-purple-200">ìƒ˜í”Œ ë°ì´í„°ë¡œ ê¸°ëŠ¥ ì²´í—˜</div>
            </button>

            <button id="docs-btn" class="bg-green-600 hover:bg-green-700 p-4 rounded-lg text-left transition-colors">
              <div class="text-lg font-semibold mb-2">ğŸ“š ë¬¸ì„œ</div>
              <div class="text-sm text-green-200">ì‚¬ìš©ë²• ë° API ë¬¸ì„œ</div>
            </button>
          </div>
        </div>
      </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 border-t border-gray-700 py-4 desktop-only">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between">
          <div class="text-sm text-gray-400">
            Â© 2024 Virtual Data v4.0.0 Phoenix - Powered by Claude AI
          </div>
          <div class="flex items-center space-x-4 text-sm text-gray-400">
            <span id="build-info">Build: 2025-09-24</span>
            <span>â€¢</span>
            <span id="memory-info">Memory: -</span>
            <span>â€¢</span>
            <span id="events-info">Events: -</span>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- Debug Panel (Hidden by default) -->
  <div id="debug-panel" class="fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-700 p-4 hidden" style="height: 300px;">
    <div class="flex items-center justify-between mb-2">
      <h3 class="font-semibold">ğŸ” ë””ë²„ê·¸ ì½˜ì†”</h3>
      <button id="debug-close" class="text-gray-400 hover:text-white">âœ•</button>
    </div>
    <div id="debug-output" class="debug-panel rounded bg-gray-800 p-2 text-green-400"></div>
  </div>

  <!-- Error Modal -->
  <div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 border border-red-500">
      <div class="flex items-center mb-4">
        <span class="text-2xl mr-3">âš ï¸</span>
        <h3 class="text-lg font-semibold text-red-400">ì‹œìŠ¤í…œ ì˜¤ë¥˜</h3>
      </div>
      <div id="error-message" class="mb-4 text-gray-300"></div>
      <div class="flex justify-end space-x-3">
        <button id="error-details-btn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm">ìƒì„¸ ì •ë³´</button>
        <button id="error-retry-btn" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-sm">ë‹¤ì‹œ ì‹œë„</button>
        <button id="error-close-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded text-sm">í™•ì¸</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 border border-gray-700 max-h-96 overflow-y-auto">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì •</h3>
        <button id="settings-close" class="text-gray-400 hover:text-white">âœ•</button>
      </div>
      <div id="settings-content">
        <!-- Settings content will be populated dynamically -->
      </div>
    </div>
  </div>

  <!-- Main App Script -->
  <script type="module">
    import { createApp } from './core/app.js';

    // ì „ì—­ ë³€ìˆ˜
    let app = null;
    let loadingProgress = 0;

    // DOM ìš”ì†Œë“¤
    const elements = {
      loadingScreen: document.getElementById('loading-screen'),
      loadingStatus: document.getElementById('loading-status'),
      loadingProgress: document.getElementById('loading-progress'),
      app: document.getElementById('app'),
      errorModal: document.getElementById('error-modal'),
      errorMessage: document.getElementById('error-message'),
      debugPanel: document.getElementById('debug-panel'),
      debugOutput: document.getElementById('debug-output')
    };

    // ë¡œë”© ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
    function updateLoadingProgress(progress, status) {
      loadingProgress = Math.min(100, Math.max(0, progress));
      elements.loadingProgress.style.width = `${loadingProgress}%`;
      elements.loadingStatus.textContent = status;
    }

    // ì—ëŸ¬ í‘œì‹œ
    function showError(message, error = null) {
      elements.errorMessage.textContent = message;
      elements.errorModal.classList.remove('hidden');

      if (error) {
        console.error('App Error:', error);
      }
    }

    // ì•± ì´ˆê¸°í™”
    async function initializeApp() {
      try {
        updateLoadingProgress(10, 'Phoenix ì‹œìŠ¤í…œ ì‹œì‘...');

        // ì•± ìƒì„±
        updateLoadingProgress(30, 'í•µì‹¬ ì‹œìŠ¤í…œ ë¡œë”©...');
        app = await createApp();

        // UI ì—…ë°ì´íŠ¸
        updateLoadingProgress(60, 'UI êµ¬ì„± ìš”ì†Œ ì´ˆê¸°í™”...');
        await setupUI();

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        updateLoadingProgress(80, 'ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ í™œì„±í™”...');
        setupEventListeners();

        // ì™„ë£Œ
        updateLoadingProgress(100, 'ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ!');

        setTimeout(() => {
          elements.loadingScreen.classList.add('hidden');
          elements.app.classList.remove('hidden');
        }, 500);

      } catch (error) {
        console.error('App initialization failed:', error);
        updateLoadingProgress(0, 'ì´ˆê¸°í™” ì‹¤íŒ¨');

        setTimeout(() => {
          elements.loadingScreen.classList.add('hidden');
          showError('ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', error);
        }, 1000);
      }
    }

    // UI ì„¤ì •
    async function setupUI() {
      // ìƒíƒœ ì—…ë°ì´íŠ¸
      updateAppStatus();
      updateModulesStatus();

      // ì£¼ê¸°ì  ì—…ë°ì´íŠ¸ ì‹œì‘
      setInterval(updateAppStatus, 5000);
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    function setupEventListeners() {
      // ë””ë²„ê·¸ íŒ¨ë„
      document.getElementById('debug-btn')?.addEventListener('click', toggleDebugPanel);
      document.getElementById('debug-close')?.addEventListener('click', hideDebugPanel);

      // ì—ëŸ¬ ëª¨ë‹¬
      document.getElementById('error-close-btn')?.addEventListener('click', () => {
        elements.errorModal.classList.add('hidden');
      });

      document.getElementById('error-retry-btn')?.addEventListener('click', () => {
        elements.errorModal.classList.add('hidden');
        location.reload();
      });

      // ì„¤ì • ëª¨ë‹¬
      document.getElementById('settings-btn')?.addEventListener('click', showSettings);
      document.getElementById('settings-close')?.addEventListener('click', hideSettings);

      // ë¹ ë¥¸ ì‘ì—… ë²„íŠ¼ë“¤
      document.getElementById('setup-btn')?.addEventListener('click', showSetup);
      document.getElementById('demo-btn')?.addEventListener('click', startDemo);
      document.getElementById('docs-btn')?.addEventListener('click', showDocs);

      // ì•± ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      if (app) {
        app.events.on('app:error', (data) => {
          showError('ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', data.error);
        });

        app.events.on('module:loaded', (data) => {
          updateModulesStatus();
        });
      }
    }

    // ì•± ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateAppStatus() {
      if (!app) return;

      const state = app.getState();

      // ì•± ìƒíƒœ
      const appStatusEl = document.getElementById('app-status');
      const appStatusTextEl = document.getElementById('app-status-text');
      const appUptimeEl = document.getElementById('app-uptime');

      if (state.initialized) {
        appStatusEl.className = 'status-dot status-success';
        appStatusTextEl.textContent = 'ì •ìƒ ë™ì‘';
        appUptimeEl.textContent = `ê°€ë™ì‹œê°„: ${formatUptime(state.uptime)}`;
      } else {
        appStatusEl.className = 'status-dot status-loading';
        appStatusTextEl.textContent = 'ì´ˆê¸°í™” ì¤‘';
        appUptimeEl.textContent = '-';
      }

      // API ìƒíƒœ
      const apiUrl = app.config.getAppsScriptUrl();
      document.getElementById('api-url').textContent = apiUrl || 'ì„¤ì •ë˜ì§€ ì•ŠìŒ';

      // ì„±ëŠ¥ ì •ë³´
      updatePerformanceInfo();

      // í‘¸í„° ì •ë³´
      document.getElementById('memory-info').textContent = `Memory: ${(performance.memory?.usedJSHeapSize / 1024 / 1024).toFixed(1)}MB`;
      document.getElementById('events-info').textContent = `Events: ${app.events.getStats().totalEvents}`;
    }

    // ëª¨ë“ˆ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateModulesStatus() {
      if (!app) return;

      const modules = app.getModules();
      const modulesGrid = document.getElementById('modules-grid');

      // ëª¨ë“ˆ ì¹´ìš´íŠ¸
      document.getElementById('modules-count').textContent = `${modules.length}/4`;
      document.getElementById('modules-status').textContent = modules.length === 4 ? 'ëª¨ë“  ëª¨ë“ˆ ë¡œë“œë¨' : 'ëª¨ë“ˆ ë¡œë”© ì¤‘';
      document.getElementById('modules-list').textContent = modules.map(([name]) => name).join(', ');

      // ëª¨ë“ˆ ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸
      modulesGrid.innerHTML = '';

      const moduleNames = ['table', 'player', 'hand', 'ui'];
      moduleNames.forEach(name => {
        const module = app.getModule(name);
        const card = createModuleCard(name, module);
        modulesGrid.appendChild(card);
      });
    }

    // ëª¨ë“ˆ ì¹´ë“œ ìƒì„±
    function createModuleCard(name, module) {
      const card = document.createElement('div');
      card.className = `module-card bg-gray-700 rounded-lg p-4 ${module ? 'active' : ''}`;

      const status = module ? 'status-success' : 'status-inactive';
      const statusText = module ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”';

      card.innerHTML = `
        <div class="flex items-center justify-between mb-2">
          <span class="font-semibold capitalize">${name}</span>
          <span class="status-dot ${status}"></span>
        </div>
        <div class="text-sm text-gray-400">${statusText}</div>
        ${module ? `<div class="text-xs text-gray-500 mt-1">v${module.version || '1.0.0'}</div>` : ''}
      `;

      return card;
    }

    // ì„±ëŠ¥ ì •ë³´ ì—…ë°ì´íŠ¸
    function updatePerformanceInfo() {
      const memory = performance.memory;
      if (memory) {
        const used = (memory.usedJSHeapSize / 1024 / 1024).toFixed(1);
        const total = (memory.totalJSHeapSize / 1024 / 1024).toFixed(1);

        document.getElementById('perf-indicator').textContent = `${used}MB`;
        document.getElementById('perf-status').textContent = 'ì •ìƒ';
        document.getElementById('memory-usage').textContent = `${used}/${total}MB`;
      }
    }

    // ì‹œê°„ í¬ë§¤íŒ…
    function formatUptime(ms) {
      const seconds = Math.floor(ms / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);

      if (hours > 0) return `${hours}ì‹œê°„ ${minutes % 60}ë¶„`;
      if (minutes > 0) return `${minutes}ë¶„ ${seconds % 60}ì´ˆ`;
      return `${seconds}ì´ˆ`;
    }

    // ë””ë²„ê·¸ íŒ¨ë„
    function toggleDebugPanel() {
      const panel = elements.debugPanel;
      panel.classList.toggle('hidden');

      if (!panel.classList.contains('hidden')) {
        updateDebugOutput();
      }
    }

    function hideDebugPanel() {
      elements.debugPanel.classList.add('hidden');
    }

    function updateDebugOutput() {
      if (!app) return;

      const debugInfo = {
        app: app.getState(),
        modules: app.getModules().map(([name, module]) => ({ name, active: true })),
        events: app.events.getStats(),
        config: app.config.getAll()
      };

      elements.debugOutput.textContent = JSON.stringify(debugInfo, null, 2);
    }

    // ì„¤ì • ê´€ë ¨
    function showSettings() {
      document.getElementById('settings-modal').classList.remove('hidden');
    }

    function hideSettings() {
      document.getElementById('settings-modal').classList.add('hidden');
    }

    // ë¹ ë¥¸ ì‘ì—…ë“¤
    function showSetup() {
      alert('ì„¤ì • ê¸°ëŠ¥ì€ ê³§ êµ¬í˜„ë©ë‹ˆë‹¤.');
    }

    function startDemo() {
      alert('ë°ëª¨ ëª¨ë“œëŠ” ê³§ êµ¬í˜„ë©ë‹ˆë‹¤.');
    }

    function showDocs() {
      alert('ë¬¸ì„œëŠ” ê³§ êµ¬í˜„ë©ë‹ˆë‹¤.');
    }

    // ì•± ì‹œì‘
    document.addEventListener('DOMContentLoaded', initializeApp);

    // ì „ì—­ì— ì•± ë…¸ì¶œ (ë””ë²„ê¹…ìš©)
    window.__PHOENIX_APP__ = () => app;
  </script>
</body>
</html>