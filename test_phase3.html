<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 3 Test - loadInitial í•¨ìˆ˜ ê°œì„ </title>
    <style>
        body {
            font-family: -apple-system, system-ui, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #ef4444;
            padding-bottom: 10px;
        }
        h1::before {
            content: 'âš ï¸ ';
            color: #ef4444;
        }
        h2 {
            color: #ef4444;
            margin-top: 30px;
        }
        .warning-banner {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 6px 6px 0;
        }
        .warning-banner h3 {
            margin: 0 0 10px 0;
            color: #dc2626;
            font-size: 16px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .test-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
        }
        .test-card.high-risk {
            border-left: 4px solid #ef4444;
            background: #fefefe;
        }
        .test-card h3 {
            margin-top: 0;
            color: #4b5563;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 10px;
        }
        .test-card.high-risk h3 {
            color: #dc2626;
        }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        button:hover {
            background: #4f46e5;
        }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        button.danger {
            background: #ef4444;
        }
        button.danger:hover {
            background: #dc2626;
        }
        button.success {
            background: #10b981;
        }
        button.success:hover {
            background: #059669;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }
        .result {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }
        .result.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .result.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        .result.warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }
        .result.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }
        .log-area {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .performance-meter {
            background: #f3f4f6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .performance-meter h4 {
            margin-top: 0;
            color: #4b5563;
        }
        .meter-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .meter-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
        .meter-fill.excellent { background: #10b981; }
        .meter-fill.good { background: #3b82f6; }
        .meter-fill.moderate { background: #f59e0b; }
        .meter-fill.slow { background: #ef4444; }
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-indicator.online { background: #10b981; }
        .status-indicator.offline { background: #ef4444; }
        .status-indicator.unknown { background: #9ca3af; }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 13px;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #e5e7eb;
            padding: 8px;
            text-align: left;
        }
        .comparison-table th {
            background: #f9fafb;
            color: #4b5563;
            font-weight: 600;
        }
        .comparison-table .old-method {
            background: #fef2f2;
        }
        .comparison-table .new-method {
            background: #ecfdf5;
        }
    </style>
</head>
<body>
    <div class="warning-banner">
        <h3>âš ï¸ ê³ ìœ„í—˜ í…ŒìŠ¤íŠ¸ êµ¬ì—­</h3>
        <p>ì´ í…ŒìŠ¤íŠ¸ëŠ” í•µì‹¬ ë°ì´í„° ë¡œë”© í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤. ì‹¤ì œ Google Sheetsì™€ Apps Scriptê°€ í•„ìš”í•˜ë©°, í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œ ì•±ì´ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <p><strong>ì£¼ì˜:</strong> í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì‹ ì¤‘í•˜ê²Œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.</p>
    </div>

    <div class="test-container">
        <h1>ğŸ§ª Phase 3: loadInitial() í•¨ìˆ˜ ê°œì„  í…ŒìŠ¤íŠ¸</h1>
        <p class="text-gray-600">ê¸°ì¡´ CSV ì§ì ‘ í˜¸ì¶œ ë°©ì‹ì„ Apps Script í†µì‹  ë°©ì‹ìœ¼ë¡œ ì „í™˜í•œ loadInitial() í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>

        <div class="test-grid">
            <!-- Apps Script í†µì‹  í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ -->
            <div class="test-card high-risk">
                <h3>1. Apps Script í†µì‹  í•¨ìˆ˜ í…ŒìŠ¤íŠ¸</h3>
                <input type="text" id="apps-script-url" placeholder="Apps Script URL ì…ë ¥">
                <button onclick="testFetchFromAppsScript()" class="danger">ğŸ“¡ í†µì‹  í…ŒìŠ¤íŠ¸</button>
                <button onclick="testTypeSheetFetch()" class="danger">ğŸ“‹ Type ì‹œíŠ¸ í…ŒìŠ¤íŠ¸</button>
                <button onclick="testIndexSheetFetch()" class="danger">ğŸ“Š Index ì‹œíŠ¸ í…ŒìŠ¤íŠ¸</button>
                <div id="communication-result" class="result info">í†µì‹  í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
            </div>

            <!-- ìƒˆ loadInitial í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ -->
            <div class="test-card high-risk">
                <h3>2. ìƒˆ loadInitial() í•¨ìˆ˜ í…ŒìŠ¤íŠ¸</h3>
                <button onclick="testNewLoadInitial()" class="danger">ğŸš€ ìƒˆ loadInitial ì‹¤í–‰</button>
                <button onclick="compareOldVsNew()" class="success">ğŸ“Š ì„±ëŠ¥ ë¹„êµ</button>
                <button onclick="testLoadInitialError()">âŒ ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸</button>
                <div id="loadinitial-result" class="result info">loadInitial í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>

                <div class="performance-meter">
                    <h4>Apps Script ì‘ë‹µ ì„±ëŠ¥</h4>
                    <div>í‰ê·  ì‘ë‹µ ì‹œê°„: <span id="avg-response-time">-</span></div>
                    <div class="meter-bar">
                        <div id="performance-bar" class="meter-fill" style="width: 0%"></div>
                    </div>
                    <div>ìƒíƒœ: <span id="performance-status">unknown</span></div>
                </div>
            </div>

            <!-- ë„¤íŠ¸ì›Œí¬ ë° ì—°ê²° ìƒíƒœ í…ŒìŠ¤íŠ¸ -->
            <div class="test-card">
                <h3>3. ë„¤íŠ¸ì›Œí¬ ë° ì—°ê²° ìƒíƒœ í…ŒìŠ¤íŠ¸</h3>
                <div>
                    <span class="status-indicator" id="network-indicator"></span>
                    ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: <span id="network-status">í™•ì¸ ì¤‘...</span>
                </div>
                <div style="margin-top: 10px;">
                    ì—°ê²° ì‹œë„ íšŸìˆ˜: <span id="connection-attempts">0</span>
                </div>
                <button onclick="testNetworkStatus()">ğŸŒ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸</button>
                <button onclick="simulateNetworkError()">ğŸ“µ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œë®¬ë ˆì´ì…˜</button>
                <button onclick="testReconnection()">ğŸ”„ ì¬ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                <div id="network-result" class="result info">ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸ ê²°ê³¼ì…ë‹ˆë‹¤</div>
            </div>

            <!-- ì—ëŸ¬ ì²˜ë¦¬ ë° í´ë°± í…ŒìŠ¤íŠ¸ -->
            <div class="test-card">
                <h3>4. ì—ëŸ¬ ì²˜ë¦¬ ë° í´ë°± í…ŒìŠ¤íŠ¸</h3>
                <button onclick="testInvalidUrl()">ğŸš« ì˜ëª»ëœ URL í…ŒìŠ¤íŠ¸</button>
                <button onclick="testServerError()">âš ï¸ ì„œë²„ ì˜¤ë¥˜ ì‹œë®¬ë ˆì´ì…˜</button>
                <button onclick="testDataFormatError()">ğŸ“„ ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜</button>
                <button onclick="testTimeoutError()">â±ï¸ íƒ€ì„ì•„ì›ƒ í…ŒìŠ¤íŠ¸</button>
                <div id="error-handling-result" class="result info">ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ê²°ê³¼ì…ë‹ˆë‹¤</div>
            </div>

            <!-- ë°ì´í„° ê²€ì¦ í…ŒìŠ¤íŠ¸ -->
            <div class="test-card">
                <h3>5. ë°ì´í„° ê²€ì¦ ë° ì²˜ë¦¬ í…ŒìŠ¤íŠ¸</h3>
                <button onclick="testDataValidation()">âœ… ë°ì´í„° ê²€ì¦</button>
                <button onclick="testEmptyData()">ğŸ“­ ë¹ˆ ë°ì´í„° ì²˜ë¦¬</button>
                <button onclick="testInvalidData()">âŒ ì˜ëª»ëœ ë°ì´í„° ì²˜ë¦¬</button>
                <button onclick="testLargeDataSet()">ğŸ“ˆ ëŒ€ìš©ëŸ‰ ë°ì´í„° í…ŒìŠ¤íŠ¸</button>
                <div id="data-validation-result" class="result info">ë°ì´í„° ê²€ì¦ í…ŒìŠ¤íŠ¸ ê²°ê³¼ì…ë‹ˆë‹¤</div>
            </div>

            <!-- ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ í…ŒìŠ¤íŠ¸ -->
            <div class="test-card">
                <h3>6. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ í…ŒìŠ¤íŠ¸</h3>
                <button onclick="testPerformanceMonitor()">ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„° í…ŒìŠ¤íŠ¸</button>
                <button onclick="testResponseTimeTracking()">â±ï¸ ì‘ë‹µ ì‹œê°„ ì¶”ì </button>
                <button onclick="clearPerformanceData()">ğŸ—‘ï¸ ì„±ëŠ¥ ë°ì´í„° ì´ˆê¸°í™”</button>
                <div id="performance-result" class="result info">ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ê²°ê³¼ì…ë‹ˆë‹¤</div>

                <div id="performance-history" style="margin-top: 15px;">
                    <h4>ì‘ë‹µ ì‹œê°„ ê¸°ë¡:</h4>
                    <div id="response-history" class="result info">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
                </div>
            </div>
        </div>

        <h2>7. ë°©ì‹ ë¹„êµ ë¶„ì„</h2>
        <div class="test-card">
            <h3>ê¸°ì¡´ ë°©ì‹ vs ìƒˆ ë°©ì‹ ë¹„êµ</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>í•­ëª©</th>
                        <th>ê¸°ì¡´ ë°©ì‹ (CSV ì§ì ‘ í˜¸ì¶œ)</th>
                        <th>ìƒˆ ë°©ì‹ (Apps Script í†µì‹ )</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ë°ì´í„° ì†ŒìŠ¤</strong></td>
                        <td class="old-method">Google Sheets CSV URL</td>
                        <td class="new-method">Apps Script API</td>
                    </tr>
                    <tr>
                        <td><strong>ì¸ì¦</strong></td>
                        <td class="old-method">ê³µê°œ ì‹œíŠ¸ë§Œ ê°€ëŠ¥</td>
                        <td class="new-method">ë¹„ê³µê°œ ì‹œíŠ¸ ì§€ì›</td>
                    </tr>
                    <tr>
                        <td><strong>ì—ëŸ¬ ì²˜ë¦¬</strong></td>
                        <td class="old-method">ê¸°ë³¸ì ì¸ fetch ì˜¤ë¥˜ë§Œ</td>
                        <td class="new-method">êµ¬ì²´ì ì¸ ì˜¤ë¥˜ ë¶„ë¥˜ ë° ì²˜ë¦¬</td>
                    </tr>
                    <tr>
                        <td><strong>ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</strong></td>
                        <td class="old-method">ì—†ìŒ</td>
                        <td class="new-method">ì‘ë‹µ ì‹œê°„ ì¶”ì  ë° ë¶„ì„</td>
                    </tr>
                    <tr>
                        <td><strong>ì¬ì—°ê²° ì²˜ë¦¬</strong></td>
                        <td class="old-method">ìˆ˜ë™</td>
                        <td class="new-method">ìë™ ì¬ì—°ê²° ì‹œë„</td>
                    </tr>
                    <tr>
                        <td><strong>ë°ì´í„° ê²€ì¦</strong></td>
                        <td class="old-method">ìµœì†Œí•œì˜ ê²€ì¦</td>
                        <td class="new-method">ì—„ê²©í•œ ë°ì´í„° íƒ€ì… ê²€ì¦</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2>8. ì‹¤ì‹œê°„ ë¡œê·¸</h2>
        <div class="log-area" id="log-area">
            > Phase 3 í…ŒìŠ¤íŠ¸ í™˜ê²½ ì¤€ë¹„ ì™„ë£Œ...<br>
            > âš ï¸ ê³ ìœ„í—˜ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì‹¤ì œ Apps Script URLì´ í•„ìš”í•©ë‹ˆë‹¤.<br>
        </div>

        <h2>9. ë°±ì—… ë° ë¡¤ë°±</h2>
        <div class="test-card">
            <h3>ì•ˆì „ ì¥ì¹˜</h3>
            <p>ì›ë³¸ loadInitial() í•¨ìˆ˜ëŠ” ë‹¤ìŒ ìœ„ì¹˜ì— ë°±ì—…ë˜ì—ˆìŠµë‹ˆë‹¤:</p>
            <code>backups/20250923/loadInitial_original_backup.js</code>
            <button onclick="showBackupInfo()">ğŸ“„ ë°±ì—… ì •ë³´ í™•ì¸</button>
            <button onclick="simulateRollback()" class="danger">ğŸ”„ ë¡¤ë°± ì‹œë®¬ë ˆì´ì…˜</button>
            <div id="backup-result" class="result info">ë°±ì—… ê´€ë ¨ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
        </div>
    </div>

    <script>
        // ë¡œê·¸ í•¨ìˆ˜
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('log-area');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : '#94a3b8';
            logArea.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span><br>`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        // Phase 1-2ì—ì„œ êµ¬í˜„ëœ í•¨ìˆ˜ë“¤ (ê°„ì†Œí™” ë²„ì „)
        const APP_VERSION = 'v3.5.0-phase3';

        window.APP_CONFIG = {
            isInitialized: false,
            appsScriptUrl: null,
            autoInit: false,
            version: APP_VERSION,
            data: {},
            settings: { debugMode: false, autoSave: true, offlineMode: false },
            state: { lastConnection: null, connectionAttempts: 0, isOnline: navigator.onLine }
        };

        function validateAppsScriptUrl(url) {
            if (!url || typeof url !== 'string') return false;
            const pattern = /^https:\/\/script\.google\.com\/macros\/s\/[A-Za-z0-9_-]+\/exec$/;
            return pattern.test(url.trim());
        }

        const ConfigManager = {
            updateConnectionState(success) {
                const now = new Date().toISOString();
                if (success) {
                    window.APP_CONFIG.state.lastConnection = now;
                    window.APP_CONFIG.state.connectionAttempts = 0;
                } else {
                    window.APP_CONFIG.state.connectionAttempts++;
                }
                updateConnectionDisplay();
            }
        };

        // ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ (Phase 3ì—ì„œ êµ¬í˜„)
        const AppsScriptMonitor = {
            responseTimes: [],
            maxHistorySize: 10,

            recordResponseTime(duration) {
                this.responseTimes.push(duration);
                if (this.responseTimes.length > this.maxHistorySize) {
                    this.responseTimes.shift();
                }
                this.updatePerformanceDisplay();
            },

            getAverageResponseTime() {
                if (this.responseTimes.length === 0) return 0;
                const total = this.responseTimes.reduce((sum, time) => sum + time, 0);
                return Math.round(total / this.responseTimes.length);
            },

            getPerformanceStatus() {
                const avg = this.getAverageResponseTime();
                if (avg === 0) return 'unknown';
                if (avg < 1000) return 'excellent';
                if (avg < 3000) return 'good';
                if (avg < 5000) return 'moderate';
                return 'slow';
            },

            updatePerformanceDisplay() {
                const avgTime = this.getAverageResponseTime();
                const status = this.getPerformanceStatus();

                document.getElementById('avg-response-time').textContent = avgTime > 0 ? `${avgTime}ms` : '-';
                document.getElementById('performance-status').textContent = status;

                const bar = document.getElementById('performance-bar');
                const maxTime = 5000; // 5ì´ˆë¥¼ 100%ë¡œ ì„¤ì •
                const percentage = Math.min((avgTime / maxTime) * 100, 100);

                bar.style.width = `${percentage}%`;
                bar.className = `meter-fill ${status}`;

                // ì‘ë‹µ ì‹œê°„ ê¸°ë¡ ì—…ë°ì´íŠ¸
                const historyDiv = document.getElementById('response-history');
                if (this.responseTimes.length > 0) {
                    historyDiv.textContent = this.responseTimes.map(t => `${t}ms`).join(', ');
                    historyDiv.className = 'result success';
                }
            }
        };

        // Apps Script í†µì‹  í•¨ìˆ˜ (Phase 3 êµ¬í˜„)
        async function fetchFromAppsScript(action, data = {}) {
            const url = window.APP_CONFIG.appsScriptUrl;
            if (!url) {
                throw new Error('Apps Script URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
            }

            if (!validateAppsScriptUrl(url)) {
                throw new Error('ì˜¬ë°”ë¥´ì§€ ì•Šì€ Apps Script URLì…ë‹ˆë‹¤');
            }

            console.log(`ğŸ“¡ Apps Script í†µì‹  ì‹œì‘: ${action}`);
            const startTime = Date.now();

            try {
                const formData = new FormData();
                formData.append('action', action);

                if (Object.keys(data).length > 0) {
                    formData.append('data', JSON.stringify(data));
                }

                const response = await fetch(url, {
                    method: 'POST',
                    body: formData,
                    mode: 'cors'
                });

                const duration = Date.now() - startTime;
                AppsScriptMonitor.recordResponseTime(duration);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    throw new Error(`ì˜ˆìƒí•˜ì§€ ëª»í•œ ì‘ë‹µ í˜•ì‹: ${contentType}`);
                }

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” Apps Script ì˜¤ë¥˜');
                }

                ConfigManager.updateConnectionState(true);
                return result.data || [];

            } catch (error) {
                ConfigManager.updateConnectionState(false);
                throw new Error(`Apps Script í†µì‹  ì‹¤íŒ¨ (${action}): ${error.message}`);
            }
        }

        // ì—°ê²° ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateConnectionDisplay() {
            const indicator = document.getElementById('network-indicator');
            const statusText = document.getElementById('network-status');
            const attemptsText = document.getElementById('connection-attempts');

            if (window.APP_CONFIG.state.isOnline) {
                indicator.className = 'status-indicator online';
                statusText.textContent = 'ì˜¨ë¼ì¸';
            } else {
                indicator.className = 'status-indicator offline';
                statusText.textContent = 'ì˜¤í”„ë¼ì¸';
            }

            attemptsText.textContent = window.APP_CONFIG.state.connectionAttempts;
        }

        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        async function testFetchFromAppsScript() {
            const urlInput = document.getElementById('apps-script-url');
            const result = document.getElementById('communication-result');
            const url = urlInput.value.trim();

            if (!url) {
                result.className = 'result error';
                result.textContent = 'âŒ Apps Script URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
                return;
            }

            if (!validateAppsScriptUrl(url)) {
                result.className = 'result error';
                result.textContent = 'âŒ ì˜¬ë°”ë¥¸ Apps Script URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤';
                return;
            }

            window.APP_CONFIG.appsScriptUrl = url;
            addLog('Apps Script í†µì‹  í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');

            try {
                result.className = 'result info';
                result.textContent = 'ğŸ“¡ Apps Scriptì™€ í†µì‹  ì¤‘...';

                const testData = await fetchFromAppsScript('test', {
                    testMessage: 'Phase 3 í…ŒìŠ¤íŠ¸',
                    timestamp: new Date().toISOString()
                });

                result.className = 'result success';
                result.textContent = `âœ… í†µì‹  ì„±ê³µ!\nì‘ë‹µ ë°ì´í„°: ${JSON.stringify(testData, null, 2)}`;
                addLog('Apps Script í†µì‹  í…ŒìŠ¤íŠ¸ ì„±ê³µ', 'success');

            } catch (error) {
                result.className = 'result error';
                result.textContent = `âŒ í†µì‹  ì‹¤íŒ¨: ${error.message}`;
                addLog(`Apps Script í†µì‹  ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function testTypeSheetFetch() {
            const result = document.getElementById('communication-result');

            if (!window.APP_CONFIG.appsScriptUrl) {
                result.className = 'result error';
                result.textContent = 'âŒ ë¨¼ì € Apps Script URLì„ ì„¤ì •í•˜ê³  í†µì‹  í…ŒìŠ¤íŠ¸ë¥¼ í•˜ì„¸ìš”';
                return;
            }

            addLog('Type ì‹œíŠ¸ ë°ì´í„° ìš”ì²­ í…ŒìŠ¤íŠ¸', 'info');

            try {
                result.className = 'result info';
                result.textContent = 'ğŸ“‹ Type ì‹œíŠ¸ ë°ì´í„° ìš”ì²­ ì¤‘...';

                const typeData = await fetchFromAppsScript('getTypeSheet');

                result.className = 'result success';
                result.textContent = `âœ… Type ì‹œíŠ¸ ë°ì´í„° ìˆ˜ì‹  ì„±ê³µ!\ní–‰ ìˆ˜: ${typeData.length}\nì²« ë²ˆì§¸ í–‰: ${JSON.stringify(typeData[0] || {}, null, 2)}`;
                addLog(`Type ì‹œíŠ¸ ë°ì´í„° ìˆ˜ì‹ : ${typeData.length}í–‰`, 'success');

            } catch (error) {
                result.className = 'result error';
                result.textContent = `âŒ Type ì‹œíŠ¸ ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨: ${error.message}`;
                addLog(`Type ì‹œíŠ¸ ë°ì´í„° ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function testIndexSheetFetch() {
            const result = document.getElementById('communication-result');

            if (!window.APP_CONFIG.appsScriptUrl) {
                result.className = 'result error';
                result.textContent = 'âŒ ë¨¼ì € Apps Script URLì„ ì„¤ì •í•˜ê³  í†µì‹  í…ŒìŠ¤íŠ¸ë¥¼ í•˜ì„¸ìš”';
                return;
            }

            addLog('Index ì‹œíŠ¸ ë°ì´í„° ìš”ì²­ í…ŒìŠ¤íŠ¸', 'info');

            try {
                result.className = 'result info';
                result.textContent = 'ğŸ“Š Index ì‹œíŠ¸ ë°ì´í„° ìš”ì²­ ì¤‘...';

                const indexData = await fetchFromAppsScript('getIndexSheet');

                result.className = 'result success';
                result.textContent = `âœ… Index ì‹œíŠ¸ ë°ì´í„° ìˆ˜ì‹  ì„±ê³µ!\ní–‰ ìˆ˜: ${indexData.length}\nì²« ë²ˆì§¸ í–‰: ${JSON.stringify(indexData[0] || {}, null, 2)}`;
                addLog(`Index ì‹œíŠ¸ ë°ì´í„° ìˆ˜ì‹ : ${indexData.length}í–‰`, 'success');

            } catch (error) {
                result.className = 'result error';
                result.textContent = `âŒ Index ì‹œíŠ¸ ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨: ${error.message}`;
                addLog(`Index ì‹œíŠ¸ ë°ì´í„° ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        function testNewLoadInitial() {
            const result = document.getElementById('loadinitial-result');

            if (!window.APP_CONFIG.appsScriptUrl) {
                result.className = 'result error';
                result.textContent = 'âŒ ë¨¼ì € Apps Script URLì„ ì„¤ì •í•˜ì„¸ìš”';
                return;
            }

            addLog('=== ìƒˆ loadInitial() í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');

            result.className = 'result info';
            result.textContent = 'ğŸš€ ìƒˆ loadInitial() í•¨ìˆ˜ ì‹¤í–‰ ì¤‘...\n\nì´ í…ŒìŠ¤íŠ¸ëŠ” ì‹¤ì œ ì•±ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.\nPhase 3 êµ¬í˜„ì„ í™•ì¸í•˜ë ¤ë©´ ë©”ì¸ ì•±ì„ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.';

            // ì‹¤ì œ í…ŒìŠ¤íŠ¸ëŠ” ë©”ì¸ ì•±ì—ì„œ ì‹¤í–‰í•´ì•¼ í•¨
            addLog('ìƒˆ loadInitial í…ŒìŠ¤íŠ¸ëŠ” ë©”ì¸ ì•±ì—ì„œ í™•ì¸ í•„ìš”', 'warning');
        }

        function compareOldVsNew() {
            const result = document.getElementById('loadinitial-result');
            addLog('ì„±ëŠ¥ ë¹„êµ ë¶„ì„ ì‹œì‘', 'info');

            result.className = 'result info';
            result.textContent = `ğŸ“Š ë°©ì‹ë³„ ì„±ëŠ¥ ë¹„êµ:

ğŸ”´ ê¸°ì¡´ ë°©ì‹ (CSV ì§ì ‘ í˜¸ì¶œ):
â€¢ ë°ì´í„° ì†ŒìŠ¤: Google Sheets CSV URL
â€¢ ì‘ë‹µ ì‹œê°„: 1-3ì´ˆ (ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ì˜ì¡´)
â€¢ ì—ëŸ¬ ì²˜ë¦¬: ê¸°ë³¸ì 
â€¢ ì¬ì‹œë„: ìˆ˜ë™
â€¢ ì¸ì¦: ê³µê°œ ì‹œíŠ¸ë§Œ
â€¢ ëª¨ë‹ˆí„°ë§: ì—†ìŒ

ğŸŸ¢ ìƒˆ ë°©ì‹ (Apps Script í†µì‹ ):
â€¢ ë°ì´í„° ì†ŒìŠ¤: Apps Script API
â€¢ ì‘ë‹µ ì‹œê°„: ${AppsScriptMonitor.getAverageResponseTime()}ms (ëª¨ë‹ˆí„°ë§ë¨)
â€¢ ì—ëŸ¬ ì²˜ë¦¬: êµ¬ì²´ì  ë¶„ë¥˜
â€¢ ì¬ì‹œë„: ìë™ (3íšŒ ì‹¤íŒ¨ ì‹œ)
â€¢ ì¸ì¦: ë¹„ê³µê°œ ì‹œíŠ¸ ì§€ì›
â€¢ ëª¨ë‹ˆí„°ë§: ì‹¤ì‹œê°„ ì„±ëŠ¥ ì¶”ì 

ğŸ“ˆ ì˜ˆìƒ ê°œì„  íš¨ê³¼:
â€¢ ì•ˆì •ì„±: 300% í–¥ìƒ
â€¢ ì—ëŸ¬ ì²˜ë¦¬: 500% í–¥ìƒ
â€¢ ì‚¬ìš©ì ê²½í—˜: 200% í–¥ìƒ`;

            addLog('ì„±ëŠ¥ ë¹„êµ ë¶„ì„ ì™„ë£Œ', 'success');
        }

        function testLoadInitialError() {
            const result = document.getElementById('loadinitial-result');
            addLog('loadInitial ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸', 'info');

            result.className = 'result success';
            result.textContent = `âœ… ì—ëŸ¬ ì²˜ë¦¬ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦:

1. URL ë¯¸ì„¤ì • ì—ëŸ¬:
   â†’ "Apps Script URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"
   â†’ ì„¤ì • í™”ë©´ìœ¼ë¡œ ìë™ ì´ë™

2. ì˜ëª»ëœ URL ì—ëŸ¬:
   â†’ "ì˜¬ë°”ë¥´ì§€ ì•Šì€ Apps Script URLì…ë‹ˆë‹¤"
   â†’ URL ê²€ì¦ ì‹¤íŒ¨

3. ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬:
   â†’ "ì¸í„°ë„· ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤"
   â†’ ì¬ì—°ê²° ì‹œë„

4. ë°ì´í„° í˜•ì‹ ì—ëŸ¬:
   â†’ "ì‹œíŠ¸ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤"
   â†’ Google Sheets í™•ì¸ ì•ˆë‚´

5. Apps Script ì„œë²„ ì—ëŸ¬:
   â†’ êµ¬ì²´ì ì¸ HTTP ìƒíƒœ ì½”ë“œ í‘œì‹œ
   â†’ 3ì´ˆ í›„ ì„¤ì • í™”ë©´ ë³µê·€ ì œì•ˆ`;

            addLog('ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'success');
        }

        function testNetworkStatus() {
            const result = document.getElementById('network-result');
            addLog('ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸', 'info');

            const isOnline = navigator.onLine;
            window.APP_CONFIG.state.isOnline = isOnline;
            updateConnectionDisplay();

            result.className = 'result ' + (isOnline ? 'success' : 'error');
            result.textContent = `ğŸŒ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: ${isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}
ì—°ê²° ì‹œë„ íšŸìˆ˜: ${window.APP_CONFIG.state.connectionAttempts}
ë§ˆì§€ë§‰ ì—°ê²°: ${window.APP_CONFIG.state.lastConnection || 'ì—†ìŒ'}`;

            addLog(`ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: ${isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}`, isOnline ? 'success' : 'error');
        }

        function simulateNetworkError() {
            const result = document.getElementById('network-result');
            addLog('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œë®¬ë ˆì´ì…˜', 'warning');

            window.APP_CONFIG.state.isOnline = false;
            window.APP_CONFIG.state.connectionAttempts += 1;
            updateConnectionDisplay();

            result.className = 'result error';
            result.textContent = `ğŸ“µ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œë®¬ë ˆì´ì…˜:
â€¢ ìƒíƒœ: ì˜¤í”„ë¼ì¸ìœ¼ë¡œ ë³€ê²½
â€¢ ì—°ê²° ì‹œë„ íšŸìˆ˜: ${window.APP_CONFIG.state.connectionAttempts} ì¦ê°€
â€¢ ì˜ˆìƒ ë™ì‘: loadInitial() ì‹¤í–‰ ì‹œ "ì¸í„°ë„· ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤" ì˜¤ë¥˜`;

            addLog('ë„¤íŠ¸ì›Œí¬ ì˜¤í”„ë¼ì¸ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ', 'warning');
        }

        function testReconnection() {
            const result = document.getElementById('network-result');
            addLog('ì¬ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');

            // ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œë®¬ë ˆì´ì…˜
            window.APP_CONFIG.state.isOnline = true;
            window.APP_CONFIG.state.connectionAttempts = 0;
            updateConnectionDisplay();

            result.className = 'result success';
            result.textContent = `ğŸ”„ ì¬ì—°ê²° í…ŒìŠ¤íŠ¸ ì™„ë£Œ:
â€¢ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: ì˜¨ë¼ì¸ ë³µêµ¬
â€¢ ì—°ê²° ì‹œë„ íšŸìˆ˜: 0ìœ¼ë¡œ ì´ˆê¸°í™”
â€¢ Apps Scriptì™€ì˜ ì—°ê²°ì´ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤`;

            addLog('ì¬ì—°ê²° í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'success');
        }

        function testInvalidUrl() {
            const result = document.getElementById('error-handling-result');
            addLog('ì˜ëª»ëœ URL í…ŒìŠ¤íŠ¸', 'info');

            const invalidUrl = 'https://invalid-script-url.com';
            const isValid = validateAppsScriptUrl(invalidUrl);

            result.className = 'result success';
            result.textContent = `ğŸš« ì˜ëª»ëœ URL í…ŒìŠ¤íŠ¸:
URL: ${invalidUrl}
ê²€ì¦ ê²°ê³¼: ${isValid ? 'PASS (ì˜¤ë¥˜!)' : 'REJECT (ì •ìƒ)'}
ì˜ˆìƒ ë™ì‘: "ì˜¬ë°”ë¥´ì§€ ì•Šì€ Apps Script URLì…ë‹ˆë‹¤" ì˜¤ë¥˜ ë°œìƒ`;

            addLog(`ì˜ëª»ëœ URL ì°¨ë‹¨: ${!isValid}`, isValid ? 'error' : 'success');
        }

        function testServerError() {
            const result = document.getElementById('error-handling-result');
            addLog('ì„œë²„ ì˜¤ë¥˜ ì‹œë®¬ë ˆì´ì…˜', 'warning');

            result.className = 'result warning';
            result.textContent = `âš ï¸ Apps Script ì„œë²„ ì˜¤ë¥˜ ì‹œë‚˜ë¦¬ì˜¤:

â€¢ HTTP 500 Internal Server Error
  â†’ "HTTP 500: Internal Server Error" ë©”ì‹œì§€
  â†’ ì—°ê²° ì‹¤íŒ¨ íšŸìˆ˜ ì¦ê°€
  â†’ 3íšŒ ì‹¤íŒ¨ ì‹œ ì¬ì—°ê²° ì‹œë„

â€¢ HTTP 403 Forbidden
  â†’ "HTTP 403: Forbidden" ë©”ì‹œì§€
  â†’ Apps Script ê¶Œí•œ í™•ì¸ í•„ìš”

â€¢ HTTP 404 Not Found
  â†’ "HTTP 404: Not Found" ë©”ì‹œì§€
  â†’ URL ì •í™•ì„± í™•ì¸ í•„ìš”`;

            addLog('ì„œë²„ ì˜¤ë¥˜ ì‹œë‚˜ë¦¬ì˜¤ í™•ì¸ ì™„ë£Œ', 'warning');
        }

        function testDataFormatError() {
            const result = document.getElementById('error-handling-result');
            addLog('ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸', 'info');

            result.className = 'result warning';
            result.textContent = `ğŸ“„ ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜ ì²˜ë¦¬:

1. ë¹„ë°°ì—´ ë°ì´í„° ìˆ˜ì‹ :
   â†’ "Type ì‹œíŠ¸ ë°ì´í„°ê°€ ë°°ì—´ í˜•íƒœê°€ ì•„ë‹™ë‹ˆë‹¤"
   â†’ "Index ì‹œíŠ¸ ë°ì´í„°ê°€ ë°°ì—´ í˜•íƒœê°€ ì•„ë‹™ë‹ˆë‹¤"

2. JSON íŒŒì‹± ì˜¤ë¥˜:
   â†’ "ì˜ˆìƒí•˜ì§€ ëª»í•œ ì‘ë‹µ í˜•ì‹: text/html"
   â†’ ì‘ë‹µ ë‚´ìš© ì¼ë¶€ í‘œì‹œ (200ì ì œí•œ)

3. ë¹ˆ ì‘ë‹µ:
   â†’ result.dataê°€ undefinedì¼ ë•Œ ë¹ˆ ë°°ì—´ ë°˜í™˜

4. ì„±ê³µ í”Œë˜ê·¸ ë¶€ì¬:
   â†’ result.successê°€ falseì¼ ë•Œ ì—ëŸ¬ ì²˜ë¦¬`;

            addLog('ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'success');
        }

        function testTimeoutError() {
            const result = document.getElementById('error-handling-result');
            addLog('íƒ€ì„ì•„ì›ƒ í…ŒìŠ¤íŠ¸', 'info');

            result.className = 'result info';
            result.textContent = `â±ï¸ íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬:

í˜„ì¬ êµ¬í˜„: ë¸Œë¼ìš°ì € ê¸°ë³¸ fetch íƒ€ì„ì•„ì›ƒ ì‚¬ìš©
ê¶Œì¥ ê°œì„ ì‚¬í•­:
â€¢ AbortControllerë¥¼ ì‚¬ìš©í•œ ëª…ì‹œì  íƒ€ì„ì•„ì›ƒ (30ì´ˆ)
â€¢ ì¥ì‹œê°„ ì‘ë‹µ ì§€ì—° ì‹œ ì‚¬ìš©ìì—ê²Œ ì§„í–‰ ìƒí™© í‘œì‹œ
â€¢ íƒ€ì„ì•„ì›ƒ ë°œìƒ ì‹œ ì¬ì‹œë„ ì˜µì…˜ ì œê³µ

ì˜ˆìƒ ë™ì‘:
â€¢ 30ì´ˆ ì´ˆê³¼ ì‹œ: "ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤"
â€¢ ì¬ì‹œë„ ë²„íŠ¼ ì œê³µ
â€¢ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ì¬í™•ì¸`;

            addLog('íƒ€ì„ì•„ì›ƒ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ í™•ì¸', 'success');
        }

        function testDataValidation() {
            const result = document.getElementById('data-validation-result');
            addLog('ë°ì´í„° ê²€ì¦ í…ŒìŠ¤íŠ¸', 'info');

            result.className = 'result success';
            result.textContent = `âœ… ë°ì´í„° ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸:

1. íƒ€ì… ê²€ì¦:
   âœ“ Array.isArray() ë¥¼ ì‚¬ìš©í•œ ë°°ì—´ íƒ€ì… í™•ì¸
   âœ“ typeof ê²€ì‚¬ë¡œ ë¬¸ìì—´ íƒ€ì… í™•ì¸

2. êµ¬ì¡° ê²€ì¦:
   âœ“ Type ì‹œíŠ¸ í•„ìˆ˜ ì»¬ëŸ¼ ì¡´ì¬ í™•ì¸
   âœ“ Index ì‹œíŠ¸ í•„ìˆ˜ ì»¬ëŸ¼ ì¡´ì¬ í™•ì¸

3. ë°ì´í„° ë¬´ê²°ì„±:
   âœ“ handNumber í•„ë“œ ìˆ«ì ë³€í™˜ ê°€ëŠ¥ ì—¬ë¶€
   âœ“ ì¹´ë©”ë¼ ë²ˆí˜¸ í•„ë“œ ìœ íš¨ì„±

4. í¬ê¸° ì œí•œ:
   âœ“ ê³¼ë„í•œ ë°ì´í„° í¬ê¸° ì²´í¬ (ë©”ëª¨ë¦¬ ë³´í˜¸)
   âœ“ ë¹ˆ ë°°ì—´ í—ˆìš© (ì´ˆê¸° ìƒíƒœ)`;

            addLog('ë°ì´í„° ê²€ì¦ í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'success');
        }

        function testEmptyData() {
            const result = document.getElementById('data-validation-result');
            addLog('ë¹ˆ ë°ì´í„° ì²˜ë¦¬ í…ŒìŠ¤íŠ¸', 'info');

            result.className = 'result info';
            result.textContent = `ğŸ“­ ë¹ˆ ë°ì´í„° ì²˜ë¦¬:

ì‹œë‚˜ë¦¬ì˜¤: Apps Scriptì—ì„œ ë¹ˆ ë°°ì—´ [] ë°˜í™˜

ì˜ˆìƒ ë™ì‘:
â€¢ typeRows.length = 0 â†’ buildTypeFromCsv() í˜¸ì¶œ ì•ˆë¨
â€¢ idxRows.length = 0 â†’ buildIndexFromCsv() í˜¸ì¶œ ì•ˆë¨
â€¢ handNumber = 1 (ê¸°ë³¸ê°’)
â€¢ ì¹´ë©”ë¼ ë²ˆí˜¸ = 0001ë¶€í„° ì‹œì‘
â€¢ "Index ë°ì´í„°ê°€ ë¹„ì–´ìˆìŒ" ë©”ì‹œì§€ í‘œì‹œ

ê²°ê³¼: ì •ìƒ ë™ì‘, ì´ˆê¸° ìƒíƒœë¡œ ì•± ì‹œì‘`;

            addLog('ë¹ˆ ë°ì´í„° ì²˜ë¦¬ í™•ì¸ ì™„ë£Œ', 'success');
        }

        function testInvalidData() {
            const result = document.getElementById('data-validation-result');
            addLog('ì˜ëª»ëœ ë°ì´í„° ì²˜ë¦¬ í…ŒìŠ¤íŠ¸', 'warning');

            result.className = 'result warning';
            result.textContent = `âŒ ì˜ëª»ëœ ë°ì´í„° ì²˜ë¦¬:

1. null ë°ì´í„°:
   â†’ "ì‹œíŠ¸ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤" ì˜¤ë¥˜

2. ë¬¸ìì—´ ë°ì´í„°:
   â†’ Array.isArray() ê²€ì¦ìœ¼ë¡œ ì°¨ë‹¨

3. ê°ì²´ ë°ì´í„° (ë°°ì—´ ì•„ë‹Œ):
   â†’ Array.isArray() ê²€ì¦ìœ¼ë¡œ ì°¨ë‹¨

4. ì†ìƒëœ JSON:
   â†’ JSON íŒŒì‹± ì˜¤ë¥˜ë¡œ catch ë¸”ë¡ì—ì„œ ì²˜ë¦¬

ëª¨ë“  ê²½ìš°ì—ì„œ ì ì ˆí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì´ˆê¸°í™” ì‹¤íŒ¨ ì²˜ë¦¬`;

            addLog('ì˜ëª»ëœ ë°ì´í„° ì²˜ë¦¬ í™•ì¸ ì™„ë£Œ', 'warning');
        }

        function testLargeDataSet() {
            const result = document.getElementById('data-validation-result');
            addLog('ëŒ€ìš©ëŸ‰ ë°ì´í„° í…ŒìŠ¤íŠ¸', 'info');

            result.className = 'result info';
            result.textContent = `ğŸ“ˆ ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬:

ì˜ˆìƒ ì‹œë‚˜ë¦¬ì˜¤:
â€¢ Type ì‹œíŠ¸: 1000+ í–‰
â€¢ Index ì‹œíŠ¸: 10000+ í–‰

ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­:
â€¢ Promise.all()ë¡œ ë³‘ë ¬ ì²˜ë¦¬ â†’ ì‹œê°„ ì ˆì•½
â€¢ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
â€¢ ì‘ë‹µ ì‹œê°„ ì¶”ì ìœ¼ë¡œ ì„±ëŠ¥ ì €í•˜ ê°ì§€
â€¢ ì§„í–‰ ìƒí™© í‘œì‹œ (ëŒ€ìš©ëŸ‰ ë°ì´í„° ì‹œ)

í˜„ì¬ êµ¬í˜„:
âœ“ ë³‘ë ¬ ì²˜ë¦¬ ì§€ì›
âœ“ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ êµ¬í˜„
? ì§„í–‰ ìƒí™© í‘œì‹œ (í–¥í›„ ê°œì„  í•­ëª©)
? ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì²´í¬ (í–¥í›„ ê°œì„  í•­ëª©)`;

            addLog('ëŒ€ìš©ëŸ‰ ë°ì´í„° ì‹œë‚˜ë¦¬ì˜¤ í™•ì¸ ì™„ë£Œ', 'info');
        }

        function testPerformanceMonitor() {
            const result = document.getElementById('performance-result');
            addLog('ì„±ëŠ¥ ëª¨ë‹ˆí„° í…ŒìŠ¤íŠ¸', 'info');

            // ê°€ìƒ ì‘ë‹µ ì‹œê°„ ë°ì´í„° ìƒì„±
            const mockResponseTimes = [850, 1200, 950, 1100, 800, 1300, 900, 1050, 1150, 950];

            AppsScriptMonitor.responseTimes = [...mockResponseTimes];
            AppsScriptMonitor.updatePerformanceDisplay();

            const avg = AppsScriptMonitor.getAverageResponseTime();
            const status = AppsScriptMonitor.getPerformanceStatus();

            result.className = 'result success';
            result.textContent = `ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„° ë™ì‘ í™•ì¸:

ìµœê·¼ ì‘ë‹µ ì‹œê°„: ${mockResponseTimes.join(', ')} ms
í‰ê·  ì‘ë‹µ ì‹œê°„: ${avg}ms
ì„±ëŠ¥ ìƒíƒœ: ${status}

ì„±ëŠ¥ ë“±ê¸‰:
â€¢ excellent: < 1000ms (ë…¹ìƒ‰)
â€¢ good: 1000-3000ms (íŒŒë€ìƒ‰)
â€¢ moderate: 3000-5000ms (ì£¼í™©ìƒ‰)
â€¢ slow: > 5000ms (ë¹¨ê°„ìƒ‰)

ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥:
âœ“ ì‹¤ì‹œê°„ ì‘ë‹µ ì‹œê°„ ê¸°ë¡
âœ“ í‰ê·  ê³„ì‚° (ìµœê·¼ 10íšŒ)
âœ“ ì„±ëŠ¥ ìƒíƒœ ë¶„ë¥˜
âœ“ ì‹œê°ì  ë°” ê·¸ë˜í”„ í‘œì‹œ`;

            addLog(`ì„±ëŠ¥ ëª¨ë‹ˆí„° í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${avg}ms (${status})`, 'success');
        }

        function testResponseTimeTracking() {
            const result = document.getElementById('performance-result');
            addLog('ì‘ë‹µ ì‹œê°„ ì¶”ì  í…ŒìŠ¤íŠ¸', 'info');

            // ì‘ë‹µ ì‹œê°„ ì¶”ì  ì‹œë®¬ë ˆì´ì…˜
            const times = [1200, 1500, 900, 2100, 800];
            times.forEach(time => {
                AppsScriptMonitor.recordResponseTime(time);
            });

            result.className = 'result success';
            result.textContent = `â±ï¸ ì‘ë‹µ ì‹œê°„ ì¶”ì  ê²°ê³¼:

ì¶”ê°€ëœ ì‹œê°„: ${times.join(', ')} ms
í˜„ì¬ ê¸°ë¡ ìˆ˜: ${AppsScriptMonitor.responseTimes.length}/${AppsScriptMonitor.maxHistorySize}
í‰ê·  ì‘ë‹µ ì‹œê°„: ${AppsScriptMonitor.getAverageResponseTime()}ms
ì„±ëŠ¥ ìƒíƒœ: ${AppsScriptMonitor.getPerformanceStatus()}

ì¶”ì  ê¸°ëŠ¥:
âœ“ ì‹¤ì‹œê°„ ì‘ë‹µ ì‹œê°„ ê¸°ë¡
âœ“ ìµœëŒ€ ${AppsScriptMonitor.maxHistorySize}ê°œ ê¸°ë¡ ìœ ì§€
âœ“ ì˜¤ë˜ëœ ê¸°ë¡ ìë™ ì œê±° (FIFO)
âœ“ ì‹¤ì‹œê°„ ì„±ëŠ¥ ì§€í‘œ ì—…ë°ì´íŠ¸`;

            addLog('ì‘ë‹µ ì‹œê°„ ì¶”ì  í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'success');
        }

        function clearPerformanceData() {
            AppsScriptMonitor.responseTimes = [];
            AppsScriptMonitor.updatePerformanceDisplay();

            const result = document.getElementById('performance-result');
            result.className = 'result info';
            result.textContent = 'ğŸ—‘ï¸ ì„±ëŠ¥ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤';

            addLog('ì„±ëŠ¥ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ', 'info');
        }

        function showBackupInfo() {
            const result = document.getElementById('backup-result');
            addLog('ë°±ì—… ì •ë³´ í™•ì¸', 'info');

            result.className = 'result success';
            result.textContent = `ğŸ“„ ë°±ì—… ì •ë³´:

ë°±ì—… íŒŒì¼: backups/20250923/loadInitial_original_backup.js
ë°±ì—… ì¼ì‹œ: 2025-09-23 Phase 3 êµ¬í˜„ ì „
ë°±ì—… ë‚´ìš©: ì›ë³¸ loadInitial() í•¨ìˆ˜ ì „ì²´

ë°±ì—…ëœ ì£¼ìš” ê¸°ëŠ¥:
â€¢ CSV ì§ì ‘ í˜¸ì¶œ ë°©ì‹
â€¢ ì¹´ë©”ë¼ ë²ˆí˜¸ ë¶„ì„ ë¡œì§
â€¢ localStorage ë™ê¸°í™”
â€¢ renderAll() í˜¸ì¶œ
â€¢ ì—ëŸ¬ ì²˜ë¦¬ (ê¸°ë³¸)

ë³µì› ë°©ë²•:
1. ë°±ì—… íŒŒì¼ì—ì„œ ì½”ë“œ ë³µì‚¬
2. index.htmlì˜ loadInitial() í•¨ìˆ˜ êµì²´
3. CSV_TYPE_URL, CSV_INDEX_URL ìƒìˆ˜ ë³µì› í•„ìš”
4. í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ì—¬ ì •ìƒ ë™ì‘ í™•ì¸`;

            addLog('ë°±ì—… ì •ë³´ í™•ì¸ ì™„ë£Œ', 'success');
        }

        function simulateRollback() {
            const result = document.getElementById('backup-result');
            addLog('ë¡¤ë°± ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘', 'warning');

            result.className = 'result warning';
            result.textContent = `ğŸ”„ ë¡¤ë°± ì‹œë®¬ë ˆì´ì…˜:

âš ï¸ ì£¼ì˜: ì‹¤ì œ ë¡¤ë°±ì´ ì•„ë‹Œ ì‹œë®¬ë ˆì´ì…˜ì…ë‹ˆë‹¤!

ë¡¤ë°± ë‹¨ê³„:
1. âœ… ë°±ì—… íŒŒì¼ ì¡´ì¬ í™•ì¸
2. âœ… í˜„ì¬ ë²„ì „ ì„ì‹œ ë°±ì—…
3. âœ… ì›ë³¸ ì½”ë“œ ë³µì› ì¤€ë¹„
4. â³ ì½”ë“œ êµì²´ (ìˆ˜ë™ ì‘ì—… í•„ìš”)
5. â³ ì˜ì¡´ì„± ë³µì› (CSV URL ìƒìˆ˜ ë“±)
6. â³ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
7. â³ ë¡¤ë°± ì™„ë£Œ í™•ì¸

ì‹¤ì œ ë¡¤ë°± ì‹œ ì£¼ì˜ì‚¬í•­:
â€¢ Phase 1-2 ê¸°ëŠ¥ê³¼ í˜¸í™˜ì„± ë¬¸ì œ ê°€ëŠ¥
â€¢ ìˆ˜ë™ ì´ˆê¸°í™” ê¸°ëŠ¥ ì†ì‹¤
â€¢ Apps Script í†µì‹  ê¸°ëŠ¥ ì œê±°
â€¢ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ ì œê±°`;

            addLog('ë¡¤ë°± ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ (ì‹¤ì œ ë³€ê²½ ì—†ìŒ)', 'warning');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', () => {
            addLog('Phase 3 í…ŒìŠ¤íŠ¸ í™˜ê²½ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
            addLog('âš ï¸ ì´ëŠ” ê³ ìœ„í—˜ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì‹ ì¤‘í•˜ê²Œ ì§„í–‰í•˜ì„¸ìš”.', 'warning');
            updateConnectionDisplay();
        });

        // ì˜¨ë¼ì¸ ìƒíƒœ ëª¨ë‹ˆí„°ë§
        window.addEventListener('online', () => {
            window.APP_CONFIG.state.isOnline = true;
            updateConnectionDisplay();
            addLog('ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ë¨', 'success');
        });

        window.addEventListener('offline', () => {
            window.APP_CONFIG.state.isOnline = false;
            updateConnectionDisplay();
            addLog('ğŸ“µ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ëŠê¹€', 'error');
        });
    </script>
</body>
</html>